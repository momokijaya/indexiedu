<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INDEXIEDU Pro - AI Education Assistant</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20640%20512'%3E%3Cpath%20fill='%23667eea'%20d='M320%2032c-17.7%200-32%2014.3-32%2032v16H224c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h64V320H128c-35.3%200-64%2028.7-64%2064s28.7%2064%2064%2064h384c35.3%200%2064-28.7%2064-64s-28.7-64-64-64H352V144h64c17.7%200%2032-14.3%2032-32s-14.3-32-32-32H352V64c0-17.7-14.3-32-32-32zM64%20288c-17.7%200-32%2014.3-32%2032v64c0%2017.7%2014.3%2032%2032%2032H576c17.7%200%2032-14.3%2032-32V320c0-17.7-14.3-32-32-32H64z'/%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc', 400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 800: '#075985', 900: '#0c4a6e',
                        },
                        accent: {
                            50: '#fef7ff', 100: '#fce7ff', 200: '#f8d4fe', 300: '#f0abfc', 400: '#e879f9', 500: '#d946ef', 600: '#c026d3', 700: '#a21caf', 800: '#86198f', 900: '#701a75',
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-soft': 'pulse-soft 3s ease-in-out infinite',
                        'shimmer': 'shimmer 2s linear infinite',
                        'bounce-soft': 'bounce-soft 2s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0px)' }, '50%': { transform: 'translateY(-10px)' } },
                        'pulse-soft': { '0%, 100%': { opacity: '1' }, '50%': { opacity: '0.8' } },
                        shimmer: { '0%': { backgroundPosition: '-200% 0' }, '100%': { backgroundPosition: '200% 0' } },
                        'bounce-soft': { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-5px)' } },
                        glow: { '0%': { boxShadow: '0 0 20px rgba(6, 182, 212, 0.3)' }, '100%': { boxShadow: '0 0 30px rgba(6, 182, 212, 0.6)' } }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@900&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- KaTeX for LaTeX Rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMckDITrE3IsidIypkoOkRdflBKoidGbItJpZLomdcAivaxNE" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlVwcpaNlchBQDfuIQA5YNp6gbaQJ5OMrLJQ8zmcITbEwbWgCNl1aGla/A+" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

    <style>
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', 'Poppins', sans-serif; }
        .font-header { font-family: 'Montserrat', sans-serif; }

        .glass-effect {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .premium-gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: premium-gradient-flow 4s ease-in-out infinite;
            font-weight: 800;
            letter-spacing: -0.025em;
        }

        @keyframes premium-gradient-flow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .premium-sidebar {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            box-shadow: 4px 0 24px rgba(0, 0, 0, 0.15);
            scrollbar-width: thin;
            scrollbar-color: #64748b #334155;
            flex-shrink: 0;
            width: 256px; /* 64 * 4px */
        }

        .premium-sidebar-item {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .premium-sidebar-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(90deg, rgba(6, 182, 212, 0.3), rgba(168, 85, 247, 0.3));
            transition: width 0.3s ease;
            z-index: 0;
        }

        .premium-sidebar-item:hover::before {
            width: 100%;
        }

        .premium-sidebar-item.active {
            background: linear-gradient(90deg, rgba(6, 182, 212, 0.2), rgba(168, 85, 247, 0.2));
            color: #06b6d4;
            font-weight: 600;
            border-left: 4px solid #06b6d4;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .premium-sidebar-item:hover:not(.active) {
            background: rgba(148, 163, 184, 0.1);
            color: white;
            transform: translateX(8px);
        }

        .premium-sidebar-item > * {
            position: relative;
            z-index: 1;
        }
        
        .content-section {
            flex-shrink: 0;
            width: 100%;
            min-width: 0;
        }
        
        /* Content and Tab Visibility Logic */
        .content-section, .tab-content, .tab-content-nested {
            display: none;
        }
        .content-section.active, .tab-content.active, .tab-content-nested.active {
            display: block;
        }
        .content-section.active, .tab-content.active {
            animation: premium-fade-in-up 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .premium-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06), 0 0 0 1px rgba(255, 255, 255, 0.05);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .premium-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #06b6d4, #8b5cf6, #ec4899);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .premium-card:hover::before {
            transform: scaleX(1);
        }

        .premium-card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.1), 0 0 40px rgba(6, 182, 212, 0.3);
        }

        .premium-feature-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            animation: premium-fade-in-up 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .premium-feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #06b6d4, #8b5cf6, #ec4899, #f59e0b);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .premium-feature-card:hover::before {
            transform: scaleX(1);
        }

        .premium-feature-card:hover {
            transform: translateY(-16px) rotateX(5deg);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 60px rgba(6, 182, 212, 0.4);
        }

        .premium-feature-card .icon-container {
            background: linear-gradient(135deg, #06b6d4, #8b5cf6);
            border-radius: 20px;
            width: 64px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .premium-feature-card .icon-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s linear infinite;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .premium-feature-card:hover .icon-container::before { opacity: 1; }

        .premium-feature-card:hover .icon-container {
            transform: scale(1.1) rotateY(10deg);
            box-shadow: 0 20px 40px rgba(6, 182, 212, 0.4);
        }

        /* Staggered animation delays */
        .premium-feature-card:nth-child(1) { animation-delay: 0.1s; }
        .premium-feature-card:nth-child(2) { animation-delay: 0.15s; }
        .premium-feature-card:nth-child(3) { animation-delay: 0.2s; }
        .premium-feature-card:nth-child(4) { animation-delay: 0.25s; }
        .premium-feature-card:nth-child(5) { animation-delay: 0.3s; }
        .premium-feature-card:nth-child(6) { animation-delay: 0.35s; }
        .premium-feature-card:nth-child(7) { animation-delay: 0.4s; }
        .premium-feature-card:nth-child(8) { animation-delay: 0.45s; }
        .premium-feature-card:nth-child(9) { animation-delay: 0.5s; }
        .premium-feature-card:nth-child(10) { animation-delay: 0.55s; }
        .premium-feature-card:nth-child(11) { animation-delay: 0.6s; }
        .premium-feature-card:nth-child(12) { animation-delay: 0.65s; }

        .premium-button {
            background: linear-gradient(135deg, #06b6d4 0%, #8b5cf6 100%);
            border: none;
            border-radius: 16px;
            color: white;
            font-weight: 700;
            padding: 14px 28px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 25px rgba(6, 182, 212, 0.3);
        }

        .premium-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s ease;
        }

        .premium-button:hover::before { left: 100%; }
        .premium-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(6, 182, 212, 0.4);
            background: linear-gradient(135deg, #0891b2 0%, #7c3aed 100%);
        }
        .premium-button:active { transform: translateY(1px); }

        .premium-loader {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(6, 182, 212, 0.2);
            border-top: 4px solid #06b6d4;
            border-radius: 50%;
            animation: premium-spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
            position: relative;
        }

        .premium-loader::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border: 4px solid transparent;
            border-top: 4px solid rgba(139, 92, 246, 0.6);
            border-radius: 50%;
            animation: premium-spin 1.5s linear infinite reverse;
        }

        .premium-input, .premium-textarea, .premium-select {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .premium-input:focus, .premium-textarea:focus, .premium-select:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 0 4px rgba(6, 182, 212, 0.1), inset 0 2px 4px rgba(0, 0, 0, 0.05);
            transform: translateY(-1px);
        }

        .premium-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem; /* Make space for the arrow */
        }

        .premium-ai-output {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 24px;
            line-height: 1.8;
            color: #334155;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06), 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow-wrap: break-word;
            word-break: break-word;
            width: 100%;
            box-sizing: border-box;
        }

        .premium-ai-output::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #06b6d4, #8b5cf6, #ec4899, #f59e0b);
            border-radius: 20px 20px 0 0;
        }

        .premium-ai-output h2 { font-size: 1.5rem; font-weight: 800; margin-bottom: 1rem; padding-bottom: 0.5rem; background: linear-gradient(135deg, #06b6d4, #8b5cf6); -webkit-background-clip: text; background-clip: text; color: transparent; border-bottom: 3px solid #e2e8f0; }
        .premium-ai-output h3 { font-size: 1.25rem; font-weight: 700; margin: 1.25rem 0 0.75rem; color: #1e293b; }
        .premium-ai-output h4 { font-size: 1rem; font-weight: 600; margin: 1rem 0 0.5rem; color: #475569; }

        .premium-tab-button {
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: #64748b;
            font-weight: 600;
            padding: 10px 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .premium-tab-button::before {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, #06b6d4, #8b5cf6);
            transition: width 0.3s ease;
        }
        .premium-tab-button.active { color: #06b6d4; }
        .premium-tab-button.active::before { width: 100%; }
        .premium-tab-button:hover:not(.active) { color: #1e293b; background: rgba(6, 182, 212, 0.05); border-radius: 8px 8px 0 0; }

        .premium-bg-pattern {
            background-image: radial-gradient(circle at 25% 25%, rgba(6, 182, 212, 0.05) 0%, transparent 50%), radial-gradient(circle at 75% 75%, rgba(139, 92, 246, 0.05) 0%, transparent 50%);
        }

        .premium-file-upload {
            border: 2px dashed #cbd5e1;
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
        }
        .premium-file-upload:hover { border-color: #06b6d4; background: linear-gradient(145deg, #f0f9ff 0%, #e0f2fe 100%); }

        @keyframes premium-fade-in-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes premium-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes shimmer { 0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); } 100% { transform: translateX(100%) translateY(100%) rotate(45deg); } }

        /* Mobile Responsive Enhancements */
        @media (max-width: 768px) {
            .premium-feature-card {
                margin-bottom: 16px;
                padding: 1rem;
            }
            .premium-feature-card:hover { transform: translateY(-8px); }
            .premium-feature-card h3 {
                font-size: 1rem;
                margin-bottom: 0.5rem;
            }
            .premium-feature-card p {
                font-size: 0.875rem;
                line-height: 1.4;
            }
            .premium-feature-card .icon-container {
                width: 48px;
                height: 48px;
                margin-bottom: 1rem;
                border-radius: 16px;
            }
            .premium-feature-card .icon-container i {
                font-size: 1.25rem;
            }
            .premium-ai-output { padding: 16px; }
        }

        @media (max-width: 420px) {
            .premium-button {
                padding: 12px 14px;
                font-size: 0.9rem;
            }
            .premium-button .fas {
                margin-right: 0.5rem;
            }
        }

        .premium-ai-output .katex-display {
            display: block;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 20px;
            margin: 20px 0;
            background: linear-gradient(145deg, #f1f5f9, #e2e8f0);
            border-left: 6px solid #06b6d4;
            border-radius: 12px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .premium-ai-output .katex { font-size: 1.25rem; color: #1e40af; }

        .premium-mobile-header {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .floating-element { animation: float 6s ease-in-out infinite; }
        .success-state { background: linear-gradient(135deg, #d1fae5, #a7f3d0); border: 1px solid #6ee7b7; color: #065f46; }
        .error-state { background: linear-gradient(135deg, #fee2e2, #fecaca); border: 1px solid #f87171; color: #991b1b; }

        #mobile-header-title-text {
            color: transparent;
            -webkit-text-stroke: 1.5px #1e293b;
            text-stroke: 1.5px #1e293b;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 text-slate-800 premium-bg-pattern">

    <!-- Root Container -->
    <div class="relative h-screen w-full">
        <!-- Backdrop for mobile sidebar -->
        <div id="sidebar-backdrop" class="fixed inset-0 bg-black bg-opacity-60 z-30 hidden md:hidden backdrop-blur-sm"></div>

        <!-- Premium Sidebar -->
        <aside id="sidebar" class="w-64 premium-sidebar text-slate-200 flex flex-col h-full fixed top-0 left-0 z-40 transform -translate-x-full transition-all duration-500 ease-in-out md:translate-x-0">
            <div class="p-4 border-b border-slate-600/30 flex-shrink-0 relative">
                <button id="sidebar-close-btn" class="absolute top-4 right-4 text-slate-400 hover:text-white md:hidden z-50 transition-colors duration-200">
                    <i class="fas fa-times text-2xl"></i>
                </button>
                <div class="flex flex-col items-center text-center">
                    <a href="#" id="home-link-desktop" class="cursor-pointer group">
                        <div class="mb-4 px-4 py-2 bg-slate-900/30 border border-slate-500/30 rounded-xl backdrop-blur-sm shadow-inner group-hover:scale-105 transition-transform duration-300">
                             <h1 class="font-header text-3xl font-black">
                                <span class="premium-gradient-text">INDEXIEDU</span>
                            </h1>
                        </div>
                    </a>
                </div>
            </div>
            <nav class="flex-1 p-2 space-y-1 overflow-y-auto">
                <a href="#" class="premium-sidebar-item active flex items-center py-2 px-3 rounded-xl" data-target="home">
                    <i class="fas fa-home w-6 text-center text-lg"></i>
                    <span class="ml-3 font-semibold text-sm">Beranda</span>
                </a>
                
                <div class="pt-3 pb-1">
                    <p class="px-3 text-xs font-bold text-slate-400 uppercase tracking-wider">Pembuatan Materi</p>
                </div>
                <a href="#" class="premium-sidebar-item flex items-center py-2 px-3 rounded-xl" data-target="generator-materi">
                    <i class="fas fa-book-open w-6 text-center text-lg"></i><span class="ml-3 font-medium text-sm">Generator Materi</span>
                </a>
                <a href="#" class="premium-sidebar-item flex items-center py-2 px-3 rounded-xl" data-target="generator-glosarium">
                    <i class="fas fa-spell-check w-6 text-center text-lg"></i><span class="ml-3 font-medium text-sm">Generator Glosarium</span>
                </a>
                <a href="#" class="premium-sidebar-item flex items-center py-2 px-3 rounded-xl" data-target="konteks-visual">
                    <i class="fas fa-image w-6 text-center text-lg"></i><span class="ml-3 font-medium text-sm">Konteks Visual Cerdas</span>
                </a>
                <a href="#" class="premium-sidebar-item flex items-center py-2 px-3 rounded-xl" data-target="pembuat-soal">
                    <i class="fas fa-lightbulb w-6 text-center text-lg"></i><span class="ml-3 font-medium text-sm">Pembuat Soal</span>
                </a>

                <div class="pt-3 pb-1">
                    <p class="px-3 text-xs font-bold text-slate-400 uppercase tracking-wider">Pelaksanaan Pembelajaran</p>
                </div>
                <a href="#" class="premium-sidebar-item flex items-center py-2 px-3 rounded-xl" data-target="penjawab-soal">
                    <i class="fas fa-calculator w-6 text-center text-lg"></i><span class="ml-3 font-medium text-sm">Penjawab Soal Cerdas</span>
                </a>
                <a href="#" class="premium-sidebar-item flex items-center py-2 px-3 rounded-xl" data-target="perancang-proyek">
                    <i class="fas fa-sitemap w-6 text-center text-lg"></i><span class="ml-3 font-medium text-sm">Perancang Proyek (PBL)</span>
                </a>
                <a href="#" class="premium-sidebar-item flex items-center py-2 px-3 rounded-xl" data-target="pustaka-aktivitas">
                    <i class="fas fa-users w-6 text-center text-lg"></i><span class="ml-3 font-medium text-sm">Pustaka Aktivitas</span>
                </a>
                <a href="#" class="premium-sidebar-item flex items-center py-2 px-3 rounded-xl" data-target="pembuat-kuis">
                    <i class="fas fa-graduation-cap w-6 text-center text-lg"></i><span class="ml-3 font-medium text-sm">Pembuat Kuis Cepat</span>
                </a>
                <a href="#" class="premium-sidebar-item flex items-center py-2 px-3 rounded-xl" data-target="asisten-pertanyaan">
                    <i class="fas fa-question-circle w-6 text-center text-lg"></i><span class="ml-3 font-medium text-sm">Asisten Pertanyaan</span>
                </a>

                <div class="pt-3 pb-1">
                    <p class="px-3 text-xs font-bold text-slate-400 uppercase tracking-wider">Evaluasi & Administrasi</p>
                </div>
                <a href="#" class="premium-sidebar-item flex items-center py-2 px-3 rounded-xl" data-target="penilaian-otomatis">
                    <i class="fas fa-check-double w-6 text-center text-lg"></i><span class="ml-3 font-medium text-sm">Pengecekan & Penilaian AI</span>
                </a>
                <a href="#" class="premium-sidebar-item flex items-center py-2 px-3 rounded-xl" data-target="perencana-rpp">
                    <i class="fas fa-file-alt w-6 text-center text-lg"></i><span class="ml-3 font-medium text-sm">Perencana & Analisis RPP</span>
                </a>
                <a href="#" class="premium-sidebar-item flex items-center py-2 px-3 rounded-xl" data-target="komunikasi-ortu">
                    <i class="fas fa-envelope w-6 text-center text-lg"></i><span class="ml-3 font-medium text-sm">Komunikasi Orang Tua</span>
                </a>
            </nav>
            <div class="p-4 border-t border-slate-600/30 text-xs flex-shrink-0 text-slate-400 text-center">
                <div class="glass-effect rounded-xl p-3">
                    <p class="font-semibold">&copy; 2025 INDEXIEDU Professional</p>
                    <p class="text-slate-300">Developed by Apinakew</p>
                </div>
            </div>
        </aside>

        <!-- Main Content Wrapper -->
        <div class="absolute inset-0 md:left-64 flex flex-col">
            <!-- Mobile Header -->
            <header class="md:hidden flex items-center justify-between premium-mobile-header p-4 sticky top-0 z-20">
                <button id="menu-toggle" class="text-slate-700 hover:text-primary-600 p-2 rounded-lg transition-colors">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <a href="#" id="home-link-mobile" class="cursor-pointer">
                    <div class="px-3 py-1 bg-white/30 border border-slate-400/30 rounded-lg backdrop-blur-sm shadow-inner">
                        <h1 id="mobile-header-title-text" class="font-header text-2xl font-black">INDEXIEDU</h1>
                    </div>
                </a>
                <div class="w-8"></div>
            </header>

            <!-- Scrollable Main Content -->
            <main class="flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto">

                <!-- Premium Homepage -->
                <section id="home" class="content-section active">
                    <div class="max-w-7xl mx-auto">
                        <div class="text-center mb-12">
                            <h1 class="text-3xl sm:text-4xl md:text-5xl font-black text-slate-900 mb-6 leading-tight">
                                Selamat Datang, <span class="premium-gradient-text">Pendidik Hebat!</span>
                            </h1>
                            <p class="text-base sm:text-lg text-slate-600 mb-8 max-w-3xl mx-auto leading-relaxed">
                                Perangkat bantu mengajar Anda ada di sini. Pilih fitur untuk memulai.
                            </p>
                            <div class="flex flex-wrap items-center justify-center gap-2 sm:gap-4 mb-8">
                                <div class="flex items-center bg-green-100 text-green-800 px-3 py-1.5 sm:px-4 sm:py-2 rounded-full text-sm">
                                    <i class="fas fa-check-circle mr-2"></i>
                                    <span class="font-semibold">AI Tools</span>
                                </div>
                                <div class="flex items-center bg-blue-100 text-blue-800 px-3 py-1.5 sm:px-4 sm:py-2 rounded-full text-sm">
                                    <i class="fas fa-bolt mr-2"></i>
                                    <span class="font-semibold">Instant Results</span>
                                </div>
                                <div class="flex items-center bg-purple-100 text-purple-800 px-3 py-1.5 sm:px-4 sm:py-2 rounded-full text-sm">
                                    <i class="fas fa-shield-alt mr-2"></i>
                                    <span class="font-semibold">100% Secure</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 md:gap-8">
                            <!-- Premium Feature Cards -->
                            <div class="premium-feature-card p-5 sm:p-6 cursor-pointer group" data-target="generator-materi">
                                <div class="icon-container">
                                    <i class="fas fa-book-open text-2xl text-white"></i>
                                </div>
                                <h3 class="text-lg sm:text-xl font-bold mb-3 text-slate-800 group-hover:text-primary-600 transition-colors">Generator Materi</h3>
                                <p class="text-sm sm:text-base text-slate-600 leading-relaxed">Buat materi ajar berkualitas tinggi dari topik kurikulum atau ide kustom Anda dengan AI terdepan.</p>
                                <div class="mt-5 flex items-center text-primary-600 font-semibold text-sm">
                                    <span>Mulai Sekarang</span>
                                    <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>

                            <div class="premium-feature-card p-5 sm:p-6 cursor-pointer group" data-target="generator-glosarium">
                                <div class="icon-container">
                                    <i class="fas fa-spell-check text-2xl text-white"></i>
                                </div>
                                <h3 class="text-lg sm:text-xl font-bold mb-3 text-slate-800 group-hover:text-primary-600 transition-colors">Generator Glosarium</h3>
                                <p class="text-sm sm:text-base text-slate-600 leading-relaxed">Ekstrak dan jelaskan istilah kunci dari materi bacaan dengan analisis konteks mendalam.</p>
                                <div class="mt-5 flex items-center text-primary-600 font-semibold text-sm">
                                    <span>Mulai Sekarang</span>
                                    <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>

                            <div class="premium-feature-card p-5 sm:p-6 cursor-pointer group" data-target="konteks-visual">
                                <div class="icon-container">
                                    <i class="fas fa-image text-2xl text-white"></i>
                                </div>
                                <h3 class="text-lg sm:text-xl font-bold mb-3 text-slate-800 group-hover:text-primary-600 transition-colors">Konteks Visual</h3>
                                <p class="text-sm sm:text-base text-slate-600 leading-relaxed">Analisis gambar untuk bahan diskusi dan pertanyaan HOTS dengan computer vision canggih.</p>
                                <div class="mt-5 flex items-center text-primary-600 font-semibold text-sm">
                                    <span>Mulai Sekarang</span>
                                    <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>

                            <div class="premium-feature-card p-5 sm:p-6 cursor-pointer group" data-target="pembuat-soal">
                                <div class="icon-container">
                                    <i class="fas fa-lightbulb text-2xl text-white"></i>
                                </div>
                                <h3 class="text-lg sm:text-xl font-bold mb-3 text-slate-800 group-hover:text-primary-600 transition-colors">Pembuat Soal</h3>
                                <p class="text-sm sm:text-base text-slate-600 leading-relaxed">Rancang soal berkualitas dengan pembahasan rinci secara otomatis dan terstruktur.</p>
                                <div class="mt-5 flex items-center text-primary-600 font-semibold text-sm">
                                    <span>Mulai Sekarang</span>
                                    <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>

                            <div class="premium-feature-card p-5 sm:p-6 cursor-pointer group" data-target="penjawab-soal">
                                <div class="icon-container">
                                    <i class="fas fa-calculator text-2xl text-white"></i>
                                </div>
                                <h3 class="text-lg sm:text-xl font-bold mb-3 text-slate-800 group-hover:text-primary-600 transition-colors">Penjawab Soal Cerdas</h3>
                                <p class="text-sm sm:text-base text-slate-600 leading-relaxed">Dapatkan solusi dan pembahasan lengkap untuk soal teks atau gambar dengan akurasi tinggi.</p>
                                <div class="mt-5 flex items-center text-primary-600 font-semibold text-sm">
                                    <span>Mulai Sekarang</span>
                                    <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>

                            <div class="premium-feature-card p-5 sm:p-6 cursor-pointer group" data-target="perancang-proyek">
                                <div class="icon-container">
                                    <i class="fas fa-sitemap text-2xl text-white"></i>
                                </div>
                                <h3 class="text-lg sm:text-xl font-bold mb-3 text-slate-800 group-hover:text-primary-600 transition-colors">Perancang Proyek (PBL)</h3>
                                <p class="text-sm sm:text-base text-slate-600 leading-relaxed">Susun kerangka kerja proyek pembelajaran yang terstruktur dan inovatif.</p>
                                <div class="mt-5 flex items-center text-primary-600 font-semibold text-sm">
                                    <span>Mulai Sekarang</span>
                                    <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>

                            <div class="premium-feature-card p-5 sm:p-6 cursor-pointer group" data-target="pustaka-aktivitas">
                                <div class="icon-container">
                                    <i class="fas fa-users text-2xl text-white"></i>
                                </div>
                                <h3 class="text-lg sm:text-xl font-bold mb-3 text-slate-800 group-hover:text-primary-600 transition-colors">Pustaka Aktivitas</h3>
                                <p class="text-sm sm:text-base text-slate-600 leading-relaxed">Temukan ide aktivitas kelas yang interaktif dan menarik untuk semua tingkatan.</p>
                                <div class="mt-5 flex items-center text-primary-600 font-semibold text-sm">
                                    <span>Mulai Sekarang</span>
                                    <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>

                            <div class="premium-feature-card p-5 sm:p-6 cursor-pointer group" data-target="pembuat-kuis">
                                <div class="icon-container">
                                    <i class="fas fa-graduation-cap text-2xl text-white"></i>
                                </div>
                                <h3 class="text-lg sm:text-xl font-bold mb-3 text-slate-800 group-hover:text-primary-600 transition-colors">Pembuat Kuis Cepat</h3>
                                <p class="text-sm sm:text-base text-slate-600 leading-relaxed">Buat kuis formatif dengan beragam tipe soal secara instan dan profesional.</p>
                                <div class="mt-5 flex items-center text-primary-600 font-semibold text-sm">
                                    <span>Mulai Sekarang</span>
                                    <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>

                            <div class="premium-feature-card p-5 sm:p-6 cursor-pointer group" data-target="asisten-pertanyaan">
                                <div class="icon-container">
                                    <i class="fas fa-question-circle text-2xl text-white"></i>
                                </div>
                                <h3 class="text-lg sm:text-xl font-bold mb-3 text-slate-800 group-hover:text-primary-600 transition-colors">Asisten Pertanyaan</h3>
                                <p class="text-sm sm:text-base text-slate-600 leading-relaxed">Dapatkan ide kreatif untuk menjawab pertanyaan sulit dari siswa dengan mudah.</p>
                                <div class="mt-5 flex items-center text-primary-600 font-semibold text-sm">
                                    <span>Mulai Sekarang</span>
                                    <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>

                            <div class="premium-feature-card p-5 sm:p-6 cursor-pointer group" data-target="penilaian-otomatis">
                                <div class="icon-container">
                                    <i class="fas fa-magic text-2xl text-white"></i>
                                </div>
                                <h3 class="text-lg sm:text-xl font-bold mb-3 text-slate-800 group-hover:text-primary-600 transition-colors">Penilaian AI Otomatis</h3>
                                <p class="text-sm sm:text-base text-slate-600 leading-relaxed">Periksa lembar jawaban pilihan ganda & esai secara instan dengan akurasi tinggi.</p>
                                <div class="mt-5 flex items-center text-primary-600 font-semibold text-sm">
                                    <span>Mulai Sekarang</span>
                                    <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>

                            <div class="premium-feature-card p-5 sm:p-6 cursor-pointer group" data-target="perencana-rpp">
                                <div class="icon-container">
                                    <i class="fas fa-file-alt text-2xl text-white"></i>
                                </div>
                                <h3 class="text-lg sm:text-xl font-bold mb-3 text-slate-800 group-hover:text-primary-600 transition-colors">Perencana & Analisis RPP</h3>
                                <p class="text-sm sm:text-base text-slate-600 leading-relaxed">Buat draf atau dapatkan umpan balik profesional untuk RPP Anda dengan AI.</p>
                                <div class="mt-5 flex items-center text-primary-600 font-semibold text-sm">
                                    <span>Mulai Sekarang</span>
                                    <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>

                            <div class="premium-feature-card p-5 sm:p-6 cursor-pointer group" data-target="komunikasi-ortu">
                                <div class="icon-container">
                                    <i class="fas fa-envelope text-2xl text-white"></i>
                                </div>
                                <h3 class="text-lg sm:text-xl font-bold mb-3 text-slate-800 group-hover:text-primary-600 transition-colors">Komunikasi Orang Tua</h3>
                                <p class="text-sm sm:text-base text-slate-600 leading-relaxed">Buat draf pesan profesional untuk orang tua/wali siswa dengan tone yang tepat.</p>
                                <div class="mt-5 flex items-center text-primary-600 font-semibold text-sm">
                                    <span>Mulai Sekarang</span>
                                    <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Premium Stats Section -->
                        <div class="mt-16 grid grid-cols-2 md:grid-cols-4 gap-8">
                            <div class="text-center">
                                <div class="text-3xl sm:text-4xl font-black text-primary-600 mb-2">50k+</div>
                                <div class="text-slate-600 font-semibold">Guru Aktif</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl sm:text-4xl font-black text-primary-600 mb-2">1M+</div>
                                <div class="text-slate-600 font-semibold">Materi Dibuat</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl sm:text-4xl font-black text-primary-600 mb-2">99.9%</div>
                                <div class="text-slate-600 font-semibold">Uptime</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl sm:text-4xl font-black text-primary-600 mb-2">24/7</div>
                                <div class="text-slate-600 font-semibold">Support</div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Dynamic Content Sections -->
                <section id="generator-materi" class="content-section"></section>
                <section id="generator-glosarium" class="content-section"></section>
                <section id="konteks-visual" class="content-section"></section>
                <section id="pembuat-soal" class="content-section"></section>
                <section id="penjawab-soal" class="content-section"></section>
                <section id="perancang-proyek" class="content-section"></section>
                <section id="pustaka-aktivitas" class="content-section"></section>
                <section id="pembuat-kuis" class="content-section"></section>
                <section id="asisten-pertanyaan" class="content-section"></section>
                <section id="perencana-rpp" class="content-section"></section>
                <section id="penilaian-otomatis" class="content-section"></section>
                <section id="komunikasi-ortu" class="content-section"></section>

            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Mobile Sidebar Toggle ---
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menu-toggle');
            const sidebarBackdrop = document.getElementById('sidebar-backdrop');
            const sidebarCloseBtn = document.getElementById('sidebar-close-btn');
            
            function openSidebar() {
                sidebar.classList.remove('-translate-x-full');
                sidebarBackdrop.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                // Push a state so the back button can close it, preserving existing page state
                if (!history.state || !history.state.sidebarOpen) {
                    history.pushState({ ...(history.state || {}), sidebarOpen: true }, 'Sidebar');
                }
            }

            function closeSidebar() {
                sidebar.classList.add('-translate-x-full');
                sidebarBackdrop.classList.add('hidden');
                document.body.style.overflow = '';
            }

            // New handler to also manage history for UI-triggered close actions
            function handleCloseSidebar() {
                // The popstate listener will handle the visual closing. We just need to trigger it.
                if (history.state && history.state.sidebarOpen) {
                    history.back();
                } else {
                    // Fallback for safety, though should not be needed with proper state management
                    closeSidebar();
                }
            }


            if (menuToggle && sidebar && sidebarBackdrop) {
                menuToggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openSidebar();
                });
                
                // Use the new handler for UI close events
                sidebarBackdrop.addEventListener('click', handleCloseSidebar);
                
                if (sidebarCloseBtn) {
                    sidebarCloseBtn.addEventListener('click', handleCloseSidebar);
                }

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && !sidebar.classList.contains('-translate-x-full')) {
                        handleCloseSidebar();
                    }
                });
            }

            // --- API Key Management (Same as original) ---
            const apiKeys = [
                'AIzaSyDE-eC4Z5sLoyLb-gfufWybfq5FDfQ8eJA', 'AIzaSyCJCLcOLSxNzAo7Yj2OkFrvBCmriMWWY4A', 'AIzaSyBCN3QCP0JAlh8T0A4I_bnYO8dRJaxgllc',
                'AIzaSyB7ZflQgfuCdAwCdJqy5ls1mGoVQCK0Ghg', 'AIzaSyBk5rAPyic400shgKO1PAAPJYbnoYj7IqA', 'AIzaSyCEgpllq7leaQTBVE-f75plyvxVGR5W_ao',
                'AIzaSyALljReS1FmyIo97G8jTSrsxzg_Cso17Cg', 'AIzaSyD5Pnxdj4ZOAr3xAd6BiaO4IG8SG0nWGp4', 'AIzaSyDKnnXW9NA7uyMMAVG9uYUvJ4hxqcDi6_o',
                'AIzaSyChFUV-BPSFJ7poTCVR0Cxy9L8ds4Ldiww', 'AIzaSyBiJPu2xcdgwLid7qmTE4jo4kz3Z0KdVwo', 'AIzaSyBm7ybTjettHpMpOXC44RFuugTvSL9AfyM',
                'AIzaSyDkFafHvNqvVtpKhNkXVe1OauD2-fToTzI', 'AIzaSyAy67NvK3oXQlYeuHsxeZKZGZyhpS4sUIY', 'AIzaSyDqAcC5A-BCl9Jx_Phf00TSChtQsbXEdrk',
                'AIzaSyBx-6s73J21nC26BUpANly7JumBdoI9xIQ', 'AIzaSyBVKX4N-G5N_A6HJBkPYPJtuNUu71QJH00', 'AIzaSyD8Wp9dObil7_0s0H245qWI7WAboQkjdN0',
                'AIzaSyCfJqiEAATvUm0W8ObytHcVVnbfzYxtjgI', 'AIzaSyCvPrjP0JDJI5MG6fOUp4aNhcp4I_ECZRc', 'AIzaSyBvr68vnrqULhtNVZL1qAbuO5plpKH3FAk',
                'AIzaSyDb4-TEf5XpEgccDzT-ljW1-3WMAKIueI4', 'AIzaSyDn2GIW4umXSQlHqr93zr4SY_EiQ_wdPfA', 'AIzaSyCm6enRK31KfDv14xEy_DJlSBnqq0Azh_E',
                'AIzaSyDIhc8O1ZUgiNACedX042xcAm923lJlpQQ', 'AIzaSyC39ZdFoP_dL2lMCxd4toHKSiCNa6TjwLg', 'AIzaSyDH8KTnWkaC16PQzI4MCy6zN7WkDpBEKDA',
                'AIzaSyB3dWuBMb0qteIP4L6Nb6KCyBZRcKIVem8', 'AIzaSyBB5gMx6G0R02L5a2ebYlIYOwn7paZyiTM', 'AIzaSyC5a5nVr2Xl3g27CzEkM4cxDcRj18QEikw',
                'AIzaSyB9rj_61pBwo-i3o75cAlqTbNkJg55_mH4', 'AIzaSyDdhxFL_c-ng0nE2gohhnQYNZo6pDC68hc', 'AIzaSyAB3Xciz90acmlT2aaJKILGEv855ol6OAA',
                'AIzaSyCbjoknzlVgBhAllzP0bI4mLxIgJReKg6s', 'AIzaSyDxedzgoLaeH6HrH2lIGpEdy-SCW1a9KGU', 'AIzaSyCMhvZvu9xaCii5lLGJ4ZOwxrhp898qStE',
                'AIzaSyD7Q7oHvp2cizaCG8I2mvEN70_yBD8Y7Ew', 'AIzaSyAASnZpn_TOkHCqzUppJ1EdLIVLiOPYsGI', 'AIzaSyDM0YxVpninfgvtXyP0m_6WfIfAFOBmqno',
                'AIzaSyAnH3M3OO7ecyVghLFkZqH53cQM-R-pOL0', 'AIzaSyBQZxg7_o_7EX6UCmX8dwTIDJUH6APCkXk', 'AIzaSyA7YQoKMTjz4LAUhjGwOySArHJXp1HikVk',
                'AIzaSyBoOhUdRm8N4eHg4SZbZsPqddyBpyqfWxs', 'AIzaSyBB5nBm3oGH9ave0Ix8l6i6S7K-p-cDooQ', 'AIzaSyDC_xfL0rS38CVyPjjpf72HakG3r5qLrlM',
                'AIzaSyBO0jGyOHa1N926svN5k-t_l79r7Kx5jtU', 'AIzaSyBAx8MajsvGrcCbQ4uU-H_5vOWsppqMB-A', 'AIzaSyCOffgp57pdF0YStr6hx9ebRMsGNF-xVac',
                'AIzaSyBZ9DmnBWIhICwFS4rgfEAgVOWKQTvsDco', 'AIzaSyAYCj1fUO_6rKT2UgHi6Y6ITtXYFP9lcEQ', 'AIzaSyDHa1GwBT_-d40Ug5S_HGQ4fPPcsCF5HoI'
            ];
            
            let currentApiKeyIndex = parseInt(localStorage.getItem('currentApiKeyIndex')) || 0;

            function getNextApiKey() {
                const key = apiKeys[currentApiKeyIndex];
                currentApiKeyIndex = (currentApiKeyIndex + 1) % apiKeys.length;
                localStorage.setItem('currentApiKeyIndex', currentApiKeyIndex);
                let usedIndex = currentApiKeyIndex === 0 ? apiKeys.length - 1 : currentApiKeyIndex - 1;
                console.log(`Using API Key at index: ${usedIndex}`);
                return key;
            }

            // --- Curriculum Database (Same as original) ---
            const kurikulumData = {
                "TK": { "Kelompok A (4-5 Tahun)": { "Tematik": ["Diri Sendiri", "Lingkunganku", "Kebutuhanku", "Binatang", "Tanaman", "Alam Semesta"] }, "Kelompok B (5-6 Tahun)": { "Tematik": ["Keluarga, Sekolah, Masyarakat", "Pekerjaan", "Air, Udara, Api", "Alat Komunikasi", "Tanah Airku", "Gejala Alam"] } },
                "SD": { "Kelas 1": { "Pendidikan Pancasila": ["Simbol dan Sila Pancasila", "Aturan di Rumah dan Sekolah", "Menjaga Kebersihan Lingkungan"], "Bahasa Indonesia": ["Mengenal Huruf dan Suku Kata", "Membaca Kalimat Sederhana", "Menulis Nama Diri dan Objek"], "Matematika": ["Membilang Angka 1-20", "Penjumlahan dan Pengurangan Sederhana", "Mengenal Bangun Datar"] }, "Kelas 2": { "Pendidikan Pancasila": ["Hidup Rukun", "Sikap Sesuai Sila Pancasila", "Tata Tertib dan Aturan"], "Bahasa Indonesia": ["Kata Sapaan dan Kalimat Tanya", "Puisi Anak", "Membaca Dongeng"], "Matematika": ["Bilangan sampai 500", "Perkalian dan Pembagian Dasar", "Satuan Waktu (Jam) dan Panjang (cm, m)"] }, "Kelas 3": { "Pendidikan Pancasila": ["Makna Sumpah Pemuda", "Keberagaman Karakteristik Individu", "Hak dan Kewajiban di Rumah dan Sekolah"], "Bahasa Indonesia": ["Ciri-ciri Makhluk Hidup", "Perkembangan Teknologi Produksi", "Surat untuk Teman"], "Matematika": ["Operasi Hitung Campuran", "Pecahan Sederhana", "Luas dan Keliling Persegi dan Persegi Panjang"] }, "Kelas 4": { "Pendidikan Pancasila": ["Makna Sila-Sila Pancasila", "Hak dan Kewajiban sebagai Warga", "Keberagaman Suku dan Budaya"], "Bahasa Indonesia": ["Ide Pokok dan Kalimat Utama", "Teks Petunjuk Penggunaan", "Teks Deskripsi dan Narasi"], "Matematika": ["Bilangan Cacah Besar", "FPB dan KPK", "Pecahan", "Bangun Datar", "Statistika (Diagram Batang)"], "IPAS": ["Bagian Tumbuhan dan Fungsinya", "Wujud Zat", "Gaya dan Pengaruhnya", "Energi dan Perubahannya"] }, "Kelas 5": { "Pendidikan Pancasila": ["Gotong Royong", "Keberagaman Suku, Agama, dan Budaya", "Cinta Tanah Air"], "Bahasa Indonesia": ["Iklan Media Cetak dan Elektronik", "Teks Narasi Sejarah", "Surat Undangan"], "Matematika": ["Operasi Hitung Pecahan", "Kecepatan dan Debit", "Skala", "Volume Kubus dan Balok"], "IPAS": ["Sistem Organ Manusia", "Ekosistem dan Rantai Makanan", "Siklus Air", "Sistem Tata Surya"] }, "Kelas 6": { "Pendidikan Pancasila": ["Penerapan Nilai-nilai Pancasila", "Sistem Pemerintahan", "Peran Indonesia di ASEAN"], "Bahasa Indonesia": ["Teks Laporan Hasil Pengamatan", "Menyampaikan Pidato", "Mengisi Formulir"], "Matematika": ["Bilangan Bulat", "Lingkaran", "Bangun Ruang Campuran", "Statistika (Mean, Median, Modus)"], "IPAS": ["Perkembangbiakan Makhluk Hidup", "Pubertas", "Listrik dan Magnet", "Gerhana"] } },
                "SMP": { "Kelas 7": { "Pendidikan Pancasila": ["Sejarah Perumusan Pancasila", "Norma dan Keadilan", "Keberagaman dalam Bingkai Bhinneka Tunggal Ika"], "Bahasa Indonesia": ["Teks Deskripsi", "Teks Cerita Fantasi", "Teks Prosedur", "Surat Pribadi dan Surat Dinas"], "Matematika": ["Bilangan", "Himpunan", "Bentuk Aljabar", "Persamaan dan Pertidaksamaan Linear Satu Variabel"], "IPA": ["Objek IPA dan Pengamatannya", "Klasifikasi Makhluk Hidup", "Suhu dan Kalor", "Energi dalam Sistem Kehidupan"], "IPS": ["Manusia, Tempat, dan Lingkungan", "Interaksi Sosial", "Kegiatan Ekonomi", "Masa Praaksara, Hindu-Buddha, dan Islam"], "Bahasa Inggris": ["Greeting and Introduction", "Describing People", "Telling Time, Day, and Date"] }, "Kelas 8": { "Pendidikan Pancasila": ["Kedudukan dan Fungsi Pancasila", "Menumbuhkan Kesadaran terhadap UUD 1945", "Semangat Kebangkitan Nasional 1908"], "Bahasa Indonesia": ["Teks Berita", "Iklan, Slogan, dan Poster", "Teks Eksplanasi", "Teks Ulasan/Resensi"], "Matematika": ["Pola Bilangan", "Sistem Koordinat", "Relasi dan Fungsi", "Persamaan Garis Lurus", "Teorema Pythagoras", "Lingkaran"], "IPA": ["Gerak Benda dan Makhluk Hidup", "Pesawat Sederhana", "Sistem Pencernaan Manusia", "Getaran, Gelombang, dan Bunyi", "Cahaya dan Alat Optik"], "IPS": ["Pengaruh Interaksi Sosial", "Perdagangan Antardaerah", "Kolonialisme dan Imperialisme Barat"], "Bahasa Inggris": ["Asking for and Giving Opinion", "Simple Past Tense", "Recount Text"] }, "Kelas 9": { "Pendidikan Pancasila": ["Dinamika Perwujudan Pancasila", "Kedaulatan Negara Kesatuan Republik Indonesia", "Bela Negara"], "Bahasa Indonesia": ["Teks Laporan Percobaan", "Teks Pidato Persuasif", "Teks Cerpen", "Teks Tanggapan"], "Matematika": ["Bilangan Berpangkat dan Bentuk Akar", "Persamaan Kuadrat", "Fungsi Kuadrat", "Transformasi Geometri", "Bangun Ruang Sisi Lengkung"], "IPA": ["Sistem Reproduksi", "Pewarisan Sifat", "Listrik Statis dan Dinamis", "Kemagnetan", "Bioteknologi"], "IPS": ["Perubahan Sosial Budaya dan Globalisasi", "Perdagangan Internasional", "Sejarah Masa Kemerdekaan hingga Reformasi"], "Bahasa Inggris": ["Procedure Text", "Report Text", "Narrative Text"] } },
                "SMA": { "Kelas 10": { "Pendidikan Pancasila": ["Pancasila dalam Konteks Sejarah", "Lembaga-lembaga Negara", "Warga Negara Indonesia"], "Bahasa Indonesia": ["Teks Laporan Hasil Observasi", "Teks Eksposisi", "Teks Anekdot", "Debat"], "Matematika Wajib": ["Persamaan Nilai Mutlak", "Sistem Persamaan Linear Tiga Variabel", "Fungsi", "Trigonometri Dasar"], "Sejarah Indonesia": ["Konsep Berpikir Sejarah", "Manusia Purba di Indonesia", "Kerajaan Hindu-Buddha dan Islam"], "Biologi": ["Ruang Lingkup Biologi", "Keanekaragaman Hayati", "Virus, Bakteri, Protista, Fungi"], "Fisika": ["Pengukuran dan Vektor", "Gerak Lurus dan Parabola", "Dinamika Partikel (Hukum Newton)"], "Kimia": ["Hakikat Ilmu Kimia", "Struktur Atom dan Sistem Periodik", "Ikatan Kimia"], "Geografi": ["Dasar Geografi dan Pemetaan", "Litosfer dan Pedosfer", "Atmosfer", "Hidrosfer"], "Ekonomi": ["Konsep Dasar Ilmu Ekonomi", "Masalah dan Sistem Ekonomi", "Permintaan dan Penawaran"], "Sosiologi": ["Fungsi Sosiologi", "Individu, Kelompok, dan Hubungan Sosial"] }, "Kelas 11": { "Pendidikan Pancasila": ["Harmonisasi Hak dan Kewajiban Asasi Manusia", "Sistem Demokrasi Pancasila", "Ancaman terhadap Negara"], "Bahasa Indonesia": ["Teks Prosedur", "Teks Eksplanasi", "Teks Ceramah", "Karya Ilmiah"], "Matematika Wajib": ["Program Linear", "Matriks", "Transformasi Geometri", "Limit dan Turunan Fungsi Aljabar"], "Sejarah Indonesia": ["Kolonialisme dan Imperialisme", "Pergerakan Nasional", "Pendudukan Jepang dan Proklamasi"], "Biologi": ["Sel", "Jaringan Tumbuhan dan Hewan", "Sistem Organ Manusia (Gerak, Sirkulasi, Pencernaan, dll.)"], "Fisika": ["Dinamika Rotasi", "Fluida", "Suhu dan Kalor", "Termodinamika", "Gelombang"], "Kimia": ["Hidrokarbon dan Minyak Bumi", "Termokimia", "Laju Reaksi", "Kesetimbangan Kimia", "Larutan Asam Basa"], "Geografi": ["Biosfer", "Antroposfer", "Sumber Daya Alam", "Ketahanan Pangan"], "Ekonomi": ["Pendapatan Nasional", "Pertumbuhan Ekonomi", "Ketenagakerjaan", "Inflasi", "Kebijakan Moneter dan Fiskal"], "Sosiologi": ["Kelompok Sosial", "Permasalahan Sosial", "Perbedaan dan Kesetaraan", "Konflik dan Integrasi"] }, "Kelas 12": { "Pendidikan Pancasila": ["Kasus Pelanggaran Hak", "Peran Pers", "Peran Indonesia dalam Perdamaian Dunia"], "Bahasa Indonesia": ["Surat Lamaran Pekerjaan", "Teks Cerita Sejarah", "Teks Editorial", "Kritik dan Esai"], "Matematika Wajib": ["Geometri Ruang (Dimensi Tiga)", "Statistika Inferensial", "Kaidah Pencacahan", "Peluang"], "Sejarah Indonesia": ["Perjuangan Pasca Kemerdekaan", "Demokrasi Liberal dan Terpimpin", "Orde Baru dan Reformasi"], "Biologi": ["Pertumbuhan dan Perkembangan", "Metabolisme Sel", "Genetika dan Hereditas", "Evolusi", "Bioteknologi"], "Fisika": ["Listrik Arus Searah dan Bolak-balik", "Medan Magnet", "Fisika Kuantum", "Fisika Inti"], "Kimia": ["Sifat Koligatif Larutan", "Elektrokimia", "Kimia Unsur", "Senyawa Karbon", "Makromolekul"], "Geografi": ["Konsep Wilayah dan Tata Ruang", "Interaksi Desa-Kota", "Negara Maju dan Berkembang"], "Ekonomi": ["Akuntansi Perusahaan Jasa", "Jurnal Umum", "Laporan Keuangan"], "Sosiologi": ["Perubahan Sosial", "Globalisasi", "Ketimpangan Sosial", "Pemberdayaan Komunitas"] } },
                "Universitas": { "S1 (Sarjana)": { "Teknik Informatika": ["Kalkulus I", "Dasar Pemrograman", "Logika Informatika", "Sistem Digital", "Struktur Data & Algoritma"], "Ekonomi & Bisnis": ["Pengantar Ekonomi Mikro", "Pengantar Ekonomi Makro", "Matematika Ekonomi", "Akuntansi Dasar", "Pengantar Manajemen"], "Ilmu Hukum": ["Pengantar Ilmu Hukum", "Pengantar Hukum Indonesia", "Ilmu Negara", "Hukum Perdata", "Hukum Pidana"], "Ilmu Komunikasi": ["Pengantar Ilmu Komunikasi", "Teori Komunikasi", "Komunikasi Massa", "Psikologi Komunikasi", "Public Speaking"], "Psikologi": ["Psikologi Umum", "Biopsikologi", "Statistika Psikologi", "Psikologi Perkembangan", "Psikologi Sosial"] }, "S2 (Magister)": { "Manajemen": ["Manajemen Strategis", "Manajemen Pemasaran Lanjutan", "Manajemen Keuangan Korporat", "Metodologi Penelitian Bisnis"], "Teknik Informatika": ["Kecerdasan Buatan Lanjutan", "Rekayasa Perangkat Lunak Skala Besar", "Keamanan Siber", "Analisis Big Data"], "Hukum": ["Filsafat Hukum", "Teori Hukum", "Politik Hukum", "Metodologi Penelitian Hukum"] }, "S3 (Doktor)": { "Studi Pembangunan": ["Teori Pembangunan Lanjutan", "Metodologi Penelitian Kualitatif Lanjutan", "Metodologi Penelitian Kuantitatif Lanjutan", "Disertasi"], "Ilmu Ekonomi": ["Teori Mikroekonomi Lanjutan", "Teori Makroekonomi Lanjutan", "Ekonometrika", "Disertasi"], "Ilmu Komputer": ["Topik Khusus dalam AI", "Jaringan Komputer Lanjutan", "Penelitian Mandiri", "Disertasi"] } }
            };
            
            // --- Premium UI Template Functions ---
            
            // Function for single file upload
            function createPremiumFileUploaderHTML(prefix, label, helpText = '') {
                return `
                    <div class="mb-6">
                        <label for="${prefix}-gambar" class="block text-sm font-semibold text-slate-700 mb-2">${label}</label>
                        ${helpText ? `<p class="text-xs text-slate-500 mb-3">${helpText}</p>` : ''}
                        <div class="premium-file-upload">
                            <input type="file" id="${prefix}-gambar" accept="image/*" class="hidden"/>
                            <div class="cursor-pointer" onclick="document.getElementById('${prefix}-gambar').click()">
                                <i class="fas fa-cloud-upload-alt text-4xl text-primary-500 mb-4"></i>
                                <p class="text-base font-semibold text-slate-700">Klik untuk upload gambar</p>
                                <p class="text-sm text-slate-500">atau drag & drop file</p>
                            </div>
                        </div>
                        <div id="${prefix}-preview" class="mt-6 hidden relative inline-block">
                            <button id="${prefix}-remove-img" title="Hapus gambar" class="absolute top-0 right-0 -mt-3 -mr-3 bg-red-500 hover:bg-red-600 text-white rounded-full h-8 w-8 flex items-center justify-center text-lg font-bold z-10 transition-all shadow-lg">&times;</button>
                            <img id="${prefix}-preview-img" class="max-h-64 rounded-2xl border-4 border-white shadow-xl"/>
                        </div>
                    </div>
                `;
            }

            // NEW: Function for batch (multiple) file upload
            function createPremiumBatchFileUploaderHTML(prefix, label, helpText = '') {
                return `
                    <div class="mb-6">
                        <label for="${prefix}-gambar" class="block text-sm font-semibold text-slate-700 mb-2">${label}</label>
                        ${helpText ? `<p class="text-xs text-slate-500 mb-3">${helpText}</p>` : ''}
                        <div class="premium-file-upload">
                            <input type="file" id="${prefix}-gambar" accept="image/*" class="hidden" multiple/>
                            <div class="cursor-pointer" onclick="document.getElementById('${prefix}-gambar').click()">
                                <i class="fas fa-images text-4xl text-primary-500 mb-4"></i>
                                <p class="text-base font-semibold text-slate-700">Klik untuk upload gambar</p>
                                <p class="text-sm text-slate-500">Anda dapat memilih beberapa file</p>
                            </div>
                        </div>
                        <div id="${prefix}-batch-preview" class="mt-6 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4">
                           <!-- Previews will be shown here -->
                        </div>
                    </div>
                `;
            }

            function createPremiumTopicSelectorHTML(prefix, title, optionsHTML = '', buttonText = 'Generate', buttonIcon = 'fa-cogs') {
                const isAnalysis = prefix === 'rpp-analisis';
                const buttonClass = isAnalysis ? 
                    'premium-button bg-gradient-to-r from-slate-600 to-slate-800 hover:from-slate-700 hover:to-slate-900' : 
                    'premium-button';
                const backButtonHTML = '<button class="back-to-home-btn mb-4 text-slate-600 hover:text-primary-600 font-semibold flex items-center transition-colors duration-200"><i class="fas fa-arrow-left mr-2"></i> Kembali ke Beranda</button>';

                return `
                    ${backButtonHTML}
                    <div class="max-w-6xl mx-auto">
                        ${title ? `<h1 class="text-2xl sm:text-3xl font-black mb-6 text-slate-900 text-center">${title}</h1>` : ''}
                            <div class="premium-card p-4 sm:p-8">
                                <div class="mb-6">
                                    <h2 class="text-lg sm:text-xl font-bold text-slate-800 mb-4 flex items-center">
                                        <i class="fas fa-lightbulb text-primary-500 mr-3"></i>
                                        Pilih Cara Menentukan Topik
                                    </h2>
                                    <div class="glass-effect rounded-2xl p-4 sm:p-6 mb-6">
                                        <label class="text-base sm:text-lg font-semibold text-slate-800 mb-4 block flex items-center">
                                            <i class="fas fa-graduation-cap text-primary-500 mr-3"></i>
                                            Opsi 1: Kurikulum
                                        </label>
                                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                            <select id="${prefix}-jenjang" class="premium-select w-full">
                                                <option value="">Pilih Jenjang...</option>
                                            </select>
                                            <select id="${prefix}-kelas" class="premium-select w-full" disabled>
                                                <option value="">Pilih Kelas...</option>
                                            </select>
                                            <select id="${prefix}-mapel" class="premium-select w-full" disabled>
                                                <option value="">Pilih Mapel...</option>
                                            </select>
                                            <select id="${prefix}-bab" class="premium-select w-full" disabled>
                                                <option value="">Pilih Bab...</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="flex items-center my-6">
                                        <hr class="flex-grow border-t-2 border-slate-300">
                                        <span class="mx-4 text-slate-600 font-bold text-sm px-3 py-1 bg-slate-100 rounded-full">ATAU</span>
                                        <hr class="flex-grow border-t-2 border-slate-300">
                                    </div>
                                    <div>
                                        <label for="${prefix}-topik" class="text-base sm:text-lg font-semibold text-slate-800 mb-3 block flex items-center">
                                            <i class="fas fa-edit text-primary-500 mr-3"></i>
                                            Opsi 2: Tulis Topik
                                        </label>
                                        <textarea id="${prefix}-topik" rows="3" class="premium-textarea w-full" placeholder="Ketik topik spesifik Anda di sini..."></textarea>
                                        ${optionsHTML}
                                    </div>
                                </div>
                                <button id="btn-generate-${prefix}" class="${buttonClass} w-full text-base py-3">
                                    <i class="fas ${buttonIcon} mr-3"></i> ${buttonText}
                                </button>
                                <div id="${prefix}-loader" class="hidden mt-8 flex flex-col items-center">
                                    <div class="premium-loader"></div>
                                    <p class="mt-4 text-slate-600 font-medium">AI sedang bekerja untuk Anda...</p>
                                </div>
                                <div id="${prefix}-hasil" class="mt-12 hidden premium-ai-output"></div>
                            </div>
                        </div>
                `;
            }

            // --- Build Premium UI ---
            function buildPremiumUI() {
                const backButtonHTML = '<button class="back-to-home-btn mb-4 text-slate-600 hover:text-primary-600 font-semibold flex items-center transition-colors duration-200"><i class="fas fa-arrow-left mr-2"></i> Kembali ke Beranda</button>';
                
                // Generator Materi
                const materiOptions = `
                    <div class="mt-6 pt-6 border-t-2 border-slate-200">
                        <label for="materi-diferensiasi" class="flex items-center cursor-pointer p-4 glass-effect rounded-xl hover:bg-primary-50 transition-all">
                            <input type="checkbox" id="materi-diferensiasi" class="h-5 w-5 text-primary-600 border-slate-300 rounded focus:ring-primary-500 mr-4">
                            <div>
                                <span class="text-base font-semibold text-slate-700">Aktifkan Diferensiasi Materi</span>
                                <p class="text-sm text-slate-500">Buat 3 versi: disederhanakan, standar, dan pengayaan</p>
                            </div>
                        </label>
                    </div>`;
                document.getElementById('generator-materi').innerHTML = createPremiumTopicSelectorHTML('materi', 'Generator Materi Ajar', materiOptions, 'Buat Materi Berkualitas Tinggi', 'fa-magic');

                // Pembuat Soal
                const soalOptions = `
                    <div class="mt-6 pt-6 border-t-2 border-slate-200">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                            <div>
                                <label for="soal-tipe" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Tipe Soal</label>
                                <select id="soal-tipe" class="premium-select w-full">
                                    <option>Pilihan Ganda</option>
                                    <option>Esai Singkat</option>
                                    <option>Benar/Salah</option>
                                    <option>Studi Kasus</option>
                                </select>
                            </div>
                            <div>
                                <label for="soal-jumlah" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Jumlah Soal</label>
                                <input type="number" id="soal-jumlah" class="premium-input w-full" value="5" min="1" max="20">
                            </div>
                        </div>
                        <div class="mt-4">
                            <label for="soal-pembahasan" class="flex items-center cursor-pointer p-4 glass-effect rounded-xl hover:bg-primary-50 transition-all">
                                <input type="checkbox" id="soal-pembahasan" class="h-5 w-5 text-primary-600 border-slate-300 rounded focus:ring-primary-500 mr-4" checked>
                                <div>
                                    <span class="text-base font-semibold text-slate-700">Sertakan Pembahasan Rinci</span>
                                    <p class="text-sm text-slate-500">Dapatkan penjelasan untuk setiap jawaban</p>
                                </div>
                            </label>
                        </div>
                    </div>`;
                document.getElementById('pembuat-soal').innerHTML = createPremiumTopicSelectorHTML('soal', 'Pembuat Soal Otomatis Premium', soalOptions, 'Buat Soal Profesional', 'fa-lightbulb');
                
                // Pustaka Aktivitas (Premium Card Layout)
                const a_activities = [
                    { type: 'Debat', title: 'Debat Akademik', icon: 'fa-comments', desc: 'Latih kemampuan berargumen dan berpikir kritis siswa.' },
                    { type: 'Studi Kasus', title: 'Analisis Studi Kasus', icon: 'fa-file-signature', desc: 'Pelajari skenario dunia nyata dengan pendekatan analitis.' },
                    { type: 'Role-Playing', title: 'Simulasi Peran', icon: 'fa-theater-masks', desc: 'Simulasikan situasi kompleks untuk pemahaman holistik.' },
                    { type: 'Jigsaw', title: 'Pembelajaran Jigsaw', icon: 'fa-puzzle-piece', desc: 'Dorong kolaborasi tim dan akuntabilitas individual.' },
                    { type: 'Galeri Walk', title: 'Pameran Karya', icon: 'fa-images', desc: 'Presentasi dan evaluasi hasil karya secara interaktif.' }
                ];
                let premiumActivityCardsHTML = a_activities.map((activity, index) => `
                    <div class="premium-feature-card p-5 sm:p-6 cursor-pointer group activity-choice-card" data-activity-type="${activity.type}" data-activity-title="${activity.title}" style="animation-delay: ${0.2 + index * 0.1}s">
                        <div class="icon-container">
                            <i class="fas ${activity.icon} text-2xl text-white"></i>
                        </div>
                        <h3 class="text-lg sm:text-xl font-bold mb-3 text-slate-800 group-hover:text-primary-600 transition-colors">${activity.title}</h3>
                        <p class="text-sm sm:text-base text-slate-600 leading-relaxed">${activity.desc}</p>
                        <div class="mt-5 flex items-center text-primary-600 font-semibold text-sm">
                            <span>Pilih Aktivitas Ini</span>
                            <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                        </div>
                    </div>
                `).join('');

                document.getElementById('pustaka-aktivitas').innerHTML = `
                    ${backButtonHTML}
                    <div class="max-w-7xl mx-auto">
                        <div class="text-center mb-12">
                            <h1 class="text-2xl sm:text-3xl font-black mb-4 text-slate-900">Pustaka Aktivitas Interaktif</h1>
                            <p class="text-base sm:text-lg text-slate-600 max-w-3xl mx-auto">Pilih tipe aktivitas untuk menciptakan pengalaman belajar yang memorable.</p>
                        </div>
                        <div id="aktivitas-card-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 md:gap-8">
                            ${premiumActivityCardsHTML}
                        </div>
                        <div id="aktivitas-form-container" class="hidden">
                            <!-- Form will be injected here -->
                        </div>
                    </div>
                `;

                // Other sections with premium styling
                document.getElementById('pembuat-kuis').innerHTML = createPremiumTopicSelectorHTML('kuis', 'Pembuat Kuis Cepat Premium', '', 'Buat Kuis Interaktif', 'fa-graduation-cap');
                
                // RPP Section dengan tab premium
                document.getElementById('perencana-rpp').innerHTML = `
                    ${backButtonHTML}
                    <div class="max-w-7xl mx-auto">
                        <h1 class="text-2xl sm:text-3xl font-black mb-6 text-slate-900 text-center">Perencana & Analisis RPP</h1>
                        <div id="perencana-rpp-tabs-container" class="premium-card p-4 sm:p-6">
                            <div class="border-b-2 border-slate-200 mb-6">
                                <nav class="flex flex-wrap gap-x-4 sm:gap-x-8" aria-label="Tabs">
                                    <button class="premium-tab-button active text-sm sm:text-base" data-target="tab-buat-rpp">
                                        <i class="fas fa-file-plus mr-2"></i>Buat Draf RPP
                                    </button>
                                    <button class="premium-tab-button text-sm sm:text-base" data-target="tab-analisis-rpp">
                                        <i class="fas fa-search-plus mr-2"></i>Analisis RPP
                                    </button>
                                </nav>
                            </div>
                            <div id="tab-buat-rpp" class="tab-content active">
                                ${createPremiumTopicSelectorHTML('rpp', '', `
                                <div class="mt-6 pt-6 border-t-2 border-slate-200 grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                                    <div>
                                        <label for="rpp-durasi" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Durasi (menit)</label>
                                        <input type="number" id="rpp-durasi" class="premium-input w-full" value="90">
                                    </div>
                                    <div>
                                        <label for="rpp-tujuan" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Tujuan Utama</label>
                                        <input type="text" id="rpp-tujuan" class="premium-input w-full" placeholder="Contoh: Siswa mampu menjelaskan...">
                                    </div>
                                </div>`, 'Buat Draf RPP Premium', 'fa-file-alt').replace(backButtonHTML, '')}
                            </div>
                            <div id="tab-analisis-rpp" class="tab-content">
                                <div class="premium-card p-4 sm:p-6">
                                    <h2 class="text-xl sm:text-2xl font-bold mb-4 text-slate-900 flex items-center">
                                        <i class="fas fa-search-plus text-primary-500 mr-3"></i>
                                        Analisis RPP Professional
                                    </h2>
                                    <p class="text-slate-600 text-sm sm:text-base mb-6">Tempelkan draf RPP Anda untuk mendapatkan umpan balik konstruktif dari AI.</p>
                                    <label for="analisis-rpp-teks" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Tempel Draf RPP Anda</label>
                                    <textarea id="analisis-rpp-teks" rows="12" class="premium-textarea w-full" placeholder="Salin dan tempel seluruh isi RPP Anda di sini..."></textarea>
                                    <button id="btn-generate-analisis-rpp" class="premium-button bg-gradient-to-r from-slate-600 to-slate-800 hover:from-slate-700 hover:to-slate-900 mt-6 w-full text-base py-3">
                                        <i class="fas fa-search-plus mr-3"></i> Dapatkan Umpan Balik
                                    </button>
                                    <div id="analisis-rpp-loader" class="hidden mt-8 flex flex-col items-center">
                                        <div class="premium-loader"></div>
                                        <p class="mt-4 text-slate-600 font-medium">AI sedang menganalisis RPP Anda...</p>
                                    </div>
                                    <div id="analisis-rpp-hasil" class="mt-12 hidden premium-ai-output"></div>
                                </div>
                            </div>
                        </div>
                    </div>`;

                document.getElementById('generator-glosarium').innerHTML = backButtonHTML + `
                    <div class="max-w-6xl mx-auto">
                        <h1 class="text-2xl sm:text-3xl font-black mb-6 text-slate-900 text-center">Generator Glosarium & Konteks Kata</h1>
                        <div class="premium-card p-4 sm:p-8">
                            <div class="text-center mb-6">
                                <i class="fas fa-spell-check text-5xl text-primary-500 mb-4"></i>
                                <p class="text-base sm:text-lg text-slate-600">Ekstrak istilah kunci dari materi bacaan dengan AI.</p>
                            </div>
                            <label for="glosarium-teks" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Tempel Teks Materi</label>
                            <textarea id="glosarium-teks" rows="10" class="premium-textarea w-full" placeholder="Tempelkan artikel, bab buku, atau materi bacaan di sini..."></textarea>
                            <button id="btn-generate-glosarium" class="premium-button mt-6 w-full text-base py-3">
                                <i class="fas fa-magic mr-3"></i> Buat Glosarium
                            </button>
                            <div id="glosarium-loader" class="hidden mt-8 flex flex-col items-center">
                                <div class="premium-loader"></div>
                                <p class="mt-4 text-slate-600 font-medium">AI sedang mengidentifikasi istilah kunci...</p>
                            </div>
                            <div id="glosarium-hasil" class="mt-12 hidden premium-ai-output"></div>
                        </div>
                    </div>`;

                document.getElementById('konteks-visual').innerHTML = backButtonHTML + `
                    <div class="max-w-6xl mx-auto">
                        <h1 class="text-2xl sm:text-3xl font-black mb-6 text-slate-900 text-center">Konteks Visual Cerdas</h1>
                        <div class="premium-card p-4 sm:p-8">
                            <div class="text-center mb-6">
                                <i class="fas fa-image text-5xl text-primary-500 mb-4"></i>
                                <p class="text-base sm:text-lg text-slate-600">Analisis gambar untuk bahan diskusi dan pertanyaan HOTS.</p>
                            </div>
                            ${createPremiumFileUploaderHTML('konteks', 'Unggah Gambar untuk Analisis', 'Upload foto, diagram, karya seni, atau grafik.')}
                            <button id="btn-generate-konteks" class="premium-button w-full text-base py-3">
                                <i class="fas fa-search-plus mr-3"></i> Analisis Gambar
                            </button>
                            <div id="konteks-loader" class="hidden mt-8 flex flex-col items-center">
                                <div class="premium-loader"></div>
                                <p class="mt-4 text-slate-600 font-medium">AI sedang menganalisis konteks visual...</p>
                            </div>
                            <div id="konteks-hasil" class="mt-12 hidden premium-ai-output"></div>
                        </div>
                    </div>`;
                
                document.getElementById('penjawab-soal').innerHTML = backButtonHTML + `
                    <div class="max-w-6xl mx-auto">
                        <h1 class="text-2xl sm:text-3xl font-black mb-6 text-slate-900 text-center">Penjawab Soal Cerdas</h1>
                        <div class="premium-card p-4 sm:p-8">
                            <div class="text-center mb-6">
                                <i class="fas fa-calculator text-5xl text-primary-500 mb-4"></i>
                                <p class="text-base sm:text-lg text-slate-600">Dapatkan solusi lengkap untuk soal teks atau gambar (bisa lebih dari satu).</p>
                            </div>
                            <div class="mb-6">
                                <label for="penjawab-soal-teks" class="text-base sm:text-lg font-semibold text-slate-700 mb-2 block flex items-center">
                                    <i class="fas fa-keyboard text-primary-500 mr-3"></i>
                                    Konteks/Pertanyaan Tambahan (Teks)
                                </label>
                                <textarea id="penjawab-soal-teks" rows="4" class="premium-textarea w-full" placeholder="Ketik atau tempel soal di sini (opsional jika menggunakan gambar)..."></textarea>
                            </div>
                            <div class="flex items-center my-6">
                                <hr class="flex-grow border-t-2 border-slate-300">
                                <span class="mx-4 text-slate-600 font-bold text-sm px-3 py-1 bg-slate-100 rounded-full">DAN/ATAU</span>
                                <hr class="flex-grow border-t-2 border-slate-300">
                            </div>
                            ${createPremiumBatchFileUploaderHTML('penjawab-soal', 'Unggah Gambar Soal', 'Upload satu atau lebih foto soal dari buku atau lembar ujian.')}
                            <button id="btn-generate-penjawab-soal" class="premium-button w-full text-base py-3">
                                <i class="fas fa-calculator mr-3"></i> Jawab & Bahas Soal
                            </button>
                            <div id="penjawab-soal-loader" class="hidden mt-8 flex flex-col items-center">
                                <div class="premium-loader"></div>
                                <p class="mt-4 text-slate-600 font-medium">AI sedang mengerjakan soal...</p>
                            </div>
                            <div id="penjawab-soal-hasil" class="mt-12 hidden premium-ai-output"></div>
                        </div>
                    </div>`;

                document.getElementById('perancang-proyek').innerHTML = backButtonHTML + `
                    <div class="max-w-6xl mx-auto">
                        <h1 class="text-2xl sm:text-3xl font-black mb-6 text-slate-900 text-center">Perancang Proyek (PBL)</h1>
                        <div class="premium-card p-4 sm:p-8">
                            <div class="text-center mb-6">
                                <i class="fas fa-sitemap text-5xl text-primary-500 mb-4"></i>
                                <p class="text-base sm:text-lg text-slate-600">Otomatisasi perencanaan Project-Based Learning (PBL).</p>
                            </div>
                            <div class="mb-4">
                                <label for="proyek-tema" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Tema / Masalah Utama Proyek</label>
                                <input type="text" id="proyek-tema" class="premium-input w-full" placeholder="Contoh: Mengatasi Sampah Plastik">
                            </div>
                            <div class="mb-6">
                                <label for="proyek-durasi" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Estimasi Durasi Proyek</label>
                                <input type="text" id="proyek-durasi" class="premium-input w-full" placeholder="Contoh: 2-3 minggu">
                            </div>
                            <button id="btn-generate-proyek" class="premium-button w-full text-base py-3">
                                <i class="fas fa-sitemap mr-3"></i> Rancang Kerangka Proyek
                            </button>
                            <div id="proyek-loader" class="hidden mt-8 flex flex-col items-center">
                                <div class="premium-loader"></div>
                                <p class="mt-4 text-slate-600 font-medium">AI sedang merancang struktur proyek...</p>
                            </div>
                            <div id="proyek-hasil" class="mt-12 hidden premium-ai-output"></div>
                        </div>
                    </div>`;

                document.getElementById('asisten-pertanyaan').innerHTML = backButtonHTML + `
                    <div class="max-w-6xl mx-auto">
                        <h1 class="text-2xl sm:text-3xl font-black mb-6 text-slate-900 text-center">Asisten Pertanyaan Siswa</h1>
                        <div class="premium-card p-4 sm:p-8">
                            <div class="text-center mb-6">
                                <i class="fas fa-question-circle text-5xl text-primary-500 mb-4"></i>
                                <p class="text-base sm:text-lg text-slate-600">Dapatkan strategi kreatif untuk menjawab pertanyaan sulit dari siswa.</p>
                            </div>
                            <label for="pertanyaan-siswa" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Masukkan Pertanyaan Sulit</label>
                            <textarea id="pertanyaan-siswa" rows="5" class="premium-textarea w-full" placeholder="Contoh: Bu, kenapa kita tidak merasakan bumi berputar?"></textarea>
                            <button id="btn-generate-jawaban" class="premium-button mt-6 w-full text-base py-3">
                                <i class="fas fa-hands-helping mr-3"></i> Dapatkan Strategi Jawaban
                            </button>
                            <div id="jawaban-loader" class="hidden mt-8 flex flex-col items-center">
                                <div class="premium-loader"></div>
                                <p class="mt-4 text-slate-600 font-medium">AI sedang menyiapkan pendekatan terbaik...</p>
                            </div>
                            <div id="jawaban-hasil" class="mt-12 hidden premium-ai-output"></div>
                        </div>
                    </div>`;
                
                document.getElementById('penilaian-otomatis').innerHTML = backButtonHTML + `
                    <div class="max-w-7xl mx-auto">
                        <h1 class="text-2xl sm:text-3xl font-black mb-6 text-slate-900 text-center">Pengecekan & Penilaian AI</h1>
                        <div id="penilaian-tabs-container" class="premium-card p-4 sm:p-6">
                            <div class="border-b-2 border-slate-200 mb-6">
                                <nav class="flex flex-wrap gap-2" aria-label="Tabs">
                                    <button class="premium-tab-button active text-xs px-2 py-2 sm:text-sm sm:px-3 sm:py-2" data-target="tab-penilaian-terpadu">
                                        <i class="fas fa-magic mr-2"></i>Penilaian Terpadu (Batch)
                                    </button>
                                    <button class="premium-tab-button text-xs px-2 py-2 sm:text-sm sm:px-3 sm:py-2" data-target="tab-penilaian-pg">
                                        <i class="fas fa-check-circle mr-2"></i>Mode PG
                                    </button>
                                    <button class="premium-tab-button text-xs px-2 py-2 sm:text-sm sm:px-3 sm:py-2" data-target="tab-penilaian-esai">
                                        <i class="fas fa-pen-fancy mr-2"></i>Mode Esai
                                    </button>
                                </nav>
                            </div>

                            <!-- Tab: Penilaian Terpadu (Batch Enabled) -->
                            <div id="tab-penilaian-terpadu" class="tab-content active">
                                <div class="text-center mb-6">
                                    <h2 class="text-xl sm:text-2xl font-bold mb-2 text-slate-900">Penilaian Batch Lembar Jawaban Terpadu</h2>
                                    <p class="text-sm sm:text-base text-slate-600">Upload beberapa foto lembar jawaban siswa (campuran PG dan esai) untuk penilaian otomatis.</p>
                                </div>
                                
                                ${createPremiumBatchFileUploaderHTML('penilaian-terpadu', 'Unggah Lembar Jawaban Siswa', 'Pilih satu atau lebih gambar lembar jawaban')}
                                <div class="mt-6 pt-6 border-t-2 border-slate-200">
                                    <label class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Kunci Jawaban (Sangat Direkomendasikan)</label>
                                    <p class="text-sm text-slate-500 mb-3">Berikan kunci jawaban untuk akurasi maksimal. Kunci ini akan diterapkan untuk semua lembar jawaban yang diunggah.</p>
                                    <textarea id="penilaian-terpadu-kunci-teks" rows="4" class="premium-textarea w-full mb-4" placeholder="Contoh: 1. A, 2. C, 3. B ... atau poin-poin esai"></textarea>
                                    ${createPremiumFileUploaderHTML('penilaian-terpadu-kunci', 'Upload Kunci Jawaban (Gambar)', 'Opsional: upload gambar kunci jawaban')}
                                </div>
                                <div class="mt-4">
                                    <label for="penilaian-terpadu-skala" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Skala Nilai</label>
                                    <select id="penilaian-terpadu-skala" class="premium-select w-full md:w-1/2">
                                        <option>1 - 100</option><option>1 - 10</option><option>A - E</option>
                                    </select>
                                </div>
                                <button id="btn-generate-penilaian-terpadu" class="premium-button mt-6 w-full text-base py-3">
                                    <i class="fas fa-magic mr-3"></i> Periksa Semua Lembar Jawaban
                                </button>
                                <div id="penilaian-terpadu-loader" class="hidden mt-8 flex flex-col items-center">
                                    <div class="premium-loader"></div>
                                    <p class="mt-4 text-slate-600 font-medium">AI sedang menganalisis dan menilai...</p>
                                </div>
                                <div id="penilaian-terpadu-hasil" class="mt-12 hidden premium-ai-output"></div>
                            </div>

                            <!-- Tab Content for PG (Single) -->
                            <div id="tab-penilaian-pg" class="tab-content">
                                <div class="text-center mb-6">
                                    <h2 class="text-xl sm:text-2xl font-bold mb-2 text-slate-900">Mode Pilihan Ganda</h2>
                                    <p class="text-sm sm:text-base text-slate-600">Penilaian khusus lembar jawaban pilihan ganda.</p>
                                </div>
                                <div id="penilaian-pg-content-wrapper"></div>
                            </div>
                            
                            <!-- Tab Content for Esai (Single) -->
                            <div id="tab-penilaian-esai" class="tab-content">
                                <div class="text-center mb-6">
                                    <h2 class="text-xl sm:text-2xl font-bold mb-2 text-slate-900">Mode Esai</h2>
                                    <p class="text-sm sm:text-base text-slate-600">Penilaian esai mendalam dengan analisis komprehensif.</p>
                                </div>
                                <div id="penilaian-esai-content-wrapper"></div>
                            </div>
                        </div>
                    </div>`;

                document.getElementById('komunikasi-ortu').innerHTML = backButtonHTML + `
                    <div class="max-w-6xl mx-auto">
                        <h1 class="text-2xl sm:text-3xl font-black mb-6 text-slate-900 text-center">Generator Komunikasi Orang Tua</h1>
                        <div class="premium-card p-4 sm:p-8">
                            <div class="text-center mb-6">
                                <i class="fas fa-envelope text-5xl text-primary-500 mb-4"></i>
                                <p class="text-base sm:text-lg text-slate-600">Buat pesan profesional untuk komunikasi dengan orang tua/wali.</p>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-4">
                                <div>
                                    <label for="komunikasi-nama" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Nama Siswa</label>
                                    <input type="text" id="komunikasi-nama" class="premium-input w-full" placeholder="Contoh: Budi Santoso">
                                </div>
                                <div>
                                    <label for="komunikasi-tujuan" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Tujuan Komunikasi</label>
                                    <select id="komunikasi-tujuan" class="premium-select w-full">
                                        <option>Memberi apresiasi atas pencapaian</option>
                                        <option>Menyampaikan kendala belajar</option>
                                        <option>Mendiskusikan perkembangan perilaku</option>
                                        <option>Informasi kegiatan sekolah</option>
                                        <option>Undangan pertemuan orang tua</option>
                                        <option>Laporan perkembangan akademik</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-6">
                                <label for="komunikasi-poin" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Poin-Poin Kunci</label>
                                <textarea id="komunikasi-poin" rows="4" class="premium-textarea w-full" placeholder="- Aktif bertanya di kelas&#10;- Peningkatan dalam matematika&#10;- Perlu bimbingan tambahan"></textarea>
                            </div>
                            <button id="btn-generate-komunikasi" class="premium-button w-full text-base py-3">
                                <i class="fas fa-paper-plane mr-3"></i> Buat Draf Pesan
                            </button>
                            <div id="komunikasi-loader" class="hidden mt-8 flex flex-col items-center">
                                <div class="premium-loader"></div>
                                <p class="mt-4 text-slate-600 font-medium">AI sedang menyusun pesan...</p>
                            </div>
                            <div id="komunikasi-hasil" class="mt-12 hidden premium-ai-output"></div>
                        </div>
                    </div>`;
                
                // Inject PG and Esai specific content
                const pgContentWrapper = document.getElementById('penilaian-pg-content-wrapper');
                if(pgContentWrapper) {
                    pgContentWrapper.innerHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-4">
                            <div>
                                <label for="penilaian-otomatis-nama" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Nama Siswa (Opsional)</label>
                                <input type="text" id="penilaian-otomatis-nama" class="premium-input w-full" placeholder="AI akan deteksi dari gambar">
                            </div>
                            <div>
                                <label for="penilaian-otomatis-kelas" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Kelas (Opsional)</label>
                                <input type="text" id="penilaian-otomatis-kelas" class="premium-input w-full" placeholder="AI akan deteksi dari gambar">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="penilaian-otomatis-skala" class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Skala Nilai</label>
                            <select id="penilaian-otomatis-skala" class="premium-select w-full md:w-1/2">
                                <option>1 - 100</option><option>1 - 10</option><option>A - E</option>
                            </select>
                        </div>
                        <div class="mb-6">
                            ${createPremiumFileUploaderHTML('penilaian-otomatis', 'Unggah Lembar Jawaban Siswa', 'Upload lembar jawaban pilihan ganda yang sudah diisi')}
                        </div>
                        <div class="pt-6 border-t-2 border-slate-200">
                            <label class="block text-base sm:text-lg font-semibold text-slate-700 mb-2">Kunci Jawaban (Opsional)</label>
                            <p class="text-sm text-slate-500 mb-3">Untuk akurasi maksimal, berikan kunci jawaban.</p>
                            <textarea id="penilaian-otomatis-kunci-teks" rows="4" class="premium-textarea w-full mb-4" placeholder="Contoh: 1. A, 2. C, 3. B, 4. D..."></textarea>
                            ${createPremiumFileUploaderHTML('penilaian-otomatis-kunci', 'Upload Kunci Jawaban (Gambar)', 'Opsional: upload gambar kunci jawaban')}
                        </div>
                        <button id="btn-generate-penilaian-otomatis" class="premium-button mt-6 w-full text-base py-3">
                            <i class="fas fa-magic mr-3"></i> Periksa Pilihan Ganda
                        </button>
                        <div id="penilaian-otomatis-loader" class="hidden mt-8 flex flex-col items-center">
                            <div class="premium-loader"></div>
                            <p class="mt-4 text-slate-600 font-medium">AI sedang memeriksa jawaban...</p>
                        </div>
                        <div id="penilaian-otomatis-hasil" class="mt-12 hidden premium-ai-output"></div>
                    `;
                }

                const esaiContentWrapper = document.getElementById('penilaian-esai-content-wrapper');
                if(esaiContentWrapper) {
                    esaiContentWrapper.innerHTML = `
                        <div id="penilaian-esai-nested-tabs-container">
                            <nav class="mb-6 border-b border-slate-200 flex flex-wrap gap-x-4 sm:gap-x-6" aria-label="Nested Tabs">
                                <button class="premium-tab-button active text-xs sm:text-sm" data-target="tab-esai-otomatis">
                                    <i class="fas fa-robot mr-2"></i>Mode Otomatis
                                </button>
                                <button class="premium-tab-button text-xs sm:text-sm" data-target="tab-esai-manual">
                                    <i class="fas fa-user-edit mr-2"></i>Mode dengan Kunci
                                </button>
                            </nav>

                            <!-- Nested Tab: Esai Otomatis -->
                            <div id="tab-esai-otomatis" class="tab-content-nested active">
                                <div>
                                    <h3 class="text-lg sm:text-xl font-bold mb-2 text-slate-900 flex items-center">
                                        <i class="fas fa-robot text-primary-500 mr-3"></i>
                                        Mode Otomatis Penuh
                                    </h3>
                                    <p class="text-sm sm:text-base text-slate-600 mb-6">AI akan menganalisis dan menilai esai secara otomatis.</p>
                                    <div class="mb-4">
                                        <label class="block text-base font-semibold text-slate-700 mb-2">Soal Esai</label>
                                        <textarea id="penilaian-esai-otomatis-soal" rows="3" class="premium-textarea w-full" placeholder="Ketik soal esai..."></textarea>
                                    </div>
                                    <div class="pt-4 border-t border-slate-200 mb-4">
                                        <label class="block text-base font-semibold text-slate-700 mb-2">Jawaban Esai Siswa</label>
                                        <textarea id="penilaian-esai-otomatis-jawaban-teks" rows="5" class="premium-textarea w-full mb-4" placeholder="Ketik jawaban siswa..."></textarea>
                                        ${createPremiumFileUploaderHTML('penilaian-esai-otomatis-jawaban', 'Upload Jawaban Esai (Gambar)', 'Alternatif: upload foto jawaban')}
                                    </div>
                                    <div class="mb-4">
                                        <label for="penilaian-esai-otomatis-skala" class="block text-base font-semibold text-slate-700 mb-2">Skala Nilai</label>
                                        <select id="penilaian-esai-otomatis-skala" class="premium-select w-full md:w-1/2">
                                            <option>1 - 100</option><option>1 - 10</option><option>A - E</option>
                                        </select>
                                    </div>
                                    <button id="btn-generate-penilaian-esai-otomatis" class="premium-button w-full text-base py-3">
                                        <i class="fas fa-magic mr-3"></i> Nilai Esai Otomatis
                                    </button>
                                    <div id="penilaian-esai-otomatis-loader" class="hidden mt-8 flex flex-col items-center">
                                        <div class="premium-loader"></div>
                                        <p class="mt-4 text-slate-600 font-medium">AI sedang menilai esai...</p>
                                    </div>
                                    <div id="penilaian-esai-otomatis-hasil" class="mt-12 hidden premium-ai-output"></div>
                                </div>
                            </div>
                            
                            <!-- Nested Tab: Esai Manual -->
                            <div id="tab-esai-manual" class="tab-content-nested">
                                <div>
                                    <h3 class="text-lg sm:text-xl font-bold mb-2 text-slate-900 flex items-center">
                                        <i class="fas fa-user-edit text-primary-500 mr-3"></i>
                                        Mode dengan Kunci Jawaban
                                    </h3>
                                    <p class="text-sm sm:text-base text-slate-600 mb-6">Penilaian esai berdasarkan pedoman penilaian yang Anda tentukan.</p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-4">
                                        <div>
                                            <label for="penilaian-manual-nama" class="block text-base font-semibold text-slate-700 mb-2">Nama Siswa</label>
                                            <input type="text" id="penilaian-manual-nama" class="premium-input w-full" placeholder="Contoh: Ani Sari">
                                        </div>
                                        <div>
                                            <label for="penilaian-manual-kelas" class="block text-base font-semibold text-slate-700 mb-2">Kelas</label>
                                            <input type="text" id="penilaian-manual-kelas" class="premium-input w-full" placeholder="Contoh: 8B">
                                        </div>
                                    </div>
                                    <div class="pt-4 border-t border-slate-200 mb-4">
                                        <label class="block text-base font-semibold text-slate-700 mb-2">Jawaban Esai Siswa</label>
                                        <textarea id="penilaian-manual-jawaban-teks" rows="5" class="premium-textarea w-full mb-4" placeholder="Ketik jawaban siswa..."></textarea>
                                        ${createPremiumFileUploaderHTML('penilaian-manual-jawaban', 'Upload Jawaban Esai (Gambar)', 'Alternatif: upload foto jawaban')}
                                    </div>
                                    <div class="pt-4 border-t border-slate-200 mb-4">
                                        <label for="penilaian-manual-kunci" class="block text-base font-semibold text-slate-700 mb-2">Kunci Jawaban / Pedoman</label>
                                        <textarea id="penilaian-manual-kunci" rows="4" class="premium-textarea w-full" placeholder="Masukkan poin-poin penting..."></textarea>
                                    </div>
                                    <div class="mb-4">
                                        <label for="penilaian-manual-skala" class="block text-base font-semibold text-slate-700 mb-2">Skala Nilai</label>
                                        <select id="penilaian-manual-skala" class="premium-select w-full md:w-1/2">
                                            <option>1 - 100</option><option>1 - 10</option><option>A - E</option>
                                        </select>
                                    </div>
                                    <button id="btn-generate-penilaian-manual" class="premium-button bg-gradient-to-r from-slate-600 to-slate-800 hover:from-slate-700 hover:to-slate-900 w-full text-base py-3">
                                        <i class="fas fa-check-double mr-3"></i> Periksa dengan Pedoman
                                    </button>
                                    <div id="penilaian-manual-loader" class="hidden mt-8 flex flex-col items-center">
                                        <div class="premium-loader"></div>
                                        <p class="mt-4 text-slate-600 font-medium">AI sedang menganalisis...</p>
                                    </div>
                                    <div id="penilaian-manual-hasil" class="mt-12 hidden premium-ai-output"></div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
            
            // --- Premium Global Setup ---
            const sidebarItems = document.querySelectorAll('.premium-sidebar-item');
            const contentSections = document.querySelectorAll('.content-section');
            const featureCards = document.querySelectorAll('.premium-feature-card');

            // MODIFIED: Added fromPopState flag to prevent pushing history state on back/forward navigation
            function switchTab(targetId, fromPopState = false) {
                contentSections.forEach(section => section.classList.remove('active'));
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
                sidebarItems.forEach(item => {
                    item.classList.toggle('active', item.dataset.target === targetId);
                });

                // ADDED: Push state to history if not from a popstate event
                if (!fromPopState && (!history.state || history.state.page !== targetId)) {
                    history.pushState({ page: targetId }, '', `#${targetId}`);
                }

                if (window.innerWidth < 768) {
                    closeSidebar();
                }
                 // Scroll to top of main content on tab switch
                document.querySelector('main').scrollTop = 0;
            }

            sidebarItems.forEach(item => {
                item.addEventListener('click', (e) => { 
                    e.preventDefault(); 
                    switchTab(item.dataset.target); 
                });
            });
            
            featureCards.forEach(card => {
                card.addEventListener('click', () => switchTab(card.dataset.target));
            });
            
            document.getElementById('home-link-desktop')?.addEventListener('click', (e) => {
                e.preventDefault();
                switchTab('home');
            });
            document.getElementById('home-link-mobile')?.addEventListener('click', (e) => {
                e.preventDefault();
                switchTab('home');
            });

            // --- Premium Helper Functions ---
            function fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => resolve({ 
                        base64: reader.result.split(',')[1],
                        mimeType: file.type,
                        dataUrl: reader.result
                    });
                    reader.onerror = error => reject(error);
                });
            }

            function setupPremiumImageUploader(prefix) {
                const inputId = `${prefix}-gambar`;
                const previewId = `${prefix}-preview`;
                const imgId = `${prefix}-preview-img`;
                const removeBtnId = `${prefix}-remove-img`;

                const input = document.getElementById(inputId);
                const previewContainer = document.getElementById(previewId);
                const previewImg = document.getElementById(imgId);
                const removeBtn = document.getElementById(removeBtnId);

                if (!input || !previewContainer || !previewImg || !removeBtn) {
                    return;
                }

                input.addEventListener('change', function() {
                    if (this.files && this.files[0]) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            previewImg.src = e.target.result;
                            previewContainer.classList.remove('hidden');
                        }
                        reader.readAsDataURL(this.files[0]);
                    } else {
                        previewContainer.classList.add('hidden');
                    }
                });

                removeBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    input.value = ''; 
                    previewImg.src = '';
                    previewContainer.classList.add('hidden');
                });
            }

            // NEW: Batch uploader setup
            function setupPremiumBatchUploader(prefix) {
                const input = document.getElementById(`${prefix}-gambar`);
                const previewContainer = document.getElementById(`${prefix}-batch-preview`);

                if (!input || !previewContainer) return;

                input.addEventListener('change', (e) => {
                    previewContainer.innerHTML = ''; // Clear previous previews
                    if (e.target.files) {
                        Array.from(e.target.files).forEach(file => {
                            const reader = new FileReader();
                            reader.onload = (event) => {
                                const imgEl = document.createElement('img');
                                imgEl.src = event.target.result;
                                imgEl.className = 'w-full h-24 object-cover rounded-lg border-2 border-white shadow-md';
                                imgEl.title = file.name;
                                previewContainer.appendChild(imgEl);
                            };
                            reader.readAsDataURL(file);
                        });
                    }
                });
            }
            
            function initializePremiumTopicSelector(prefix) {
                const jenjangEl = document.getElementById(`${prefix}-jenjang`);
                const kelasEl = document.getElementById(`${prefix}-kelas`);
                const mapelEl = document.getElementById(`${prefix}-mapel`);
                const babEl = document.getElementById(`${prefix}-bab`);
                const topikEl = document.getElementById(`${prefix}-topik`);

                if (!jenjangEl) return;

                jenjangEl.innerHTML = '<option value="">Pilih Jenjang...</option>';
                for (const jenjang in kurikulumData) {
                    jenjangEl.innerHTML += `<option value="${jenjang}">${jenjang}</option>`;
                }

                jenjangEl.addEventListener('change', () => {
                    const selectedJenjang = jenjangEl.value;
                    kelasEl.innerHTML = '<option value="">Pilih Kelas/Tingkat...</option>';
                    mapelEl.innerHTML = '<option value="">Pilih Mapel/Prodi...</option>';
                    babEl.innerHTML = '<option value="">Pilih Bab/Materi...</option>';
                    kelasEl.disabled = true;
                    mapelEl.disabled = true;
                    babEl.disabled = true;
                    topikEl.value = '';

                    if (selectedJenjang) {
                        kelasEl.disabled = false;
                        for (const kelas in kurikulumData[selectedJenjang]) {
                            kelasEl.innerHTML += `<option value="${kelas}">${kelas}</option>`;
                        }
                    }
                });

                kelasEl.addEventListener('change', () => {
                    const selectedJenjang = jenjangEl.value;
                    const selectedKelas = kelasEl.value;
                    mapelEl.innerHTML = '<option value="">Pilih Mapel/Prodi...</option>';
                    babEl.innerHTML = '<option value="">Pilih Bab/Materi...</option>';
                    mapelEl.disabled = true;
                    babEl.disabled = true;
                    topikEl.value = '';
                    
                    if (selectedKelas) {
                        mapelEl.disabled = false;
                        for (const mapel in kurikulumData[selectedJenjang][selectedKelas]) {
                            mapelEl.innerHTML += `<option value="${mapel}">${mapel}</option>`;
                        }
                    }
                });
                
                mapelEl.addEventListener('change', () => {
                    const selectedJenjang = jenjangEl.value;
                    const selectedKelas = kelasEl.value;
                    const selectedMapel = mapelEl.value;
                    babEl.innerHTML = '<option value="">Pilih Bab/Materi...</option>';
                    babEl.disabled = true;
                    topikEl.value = '';

                    if (selectedMapel) {
                        babEl.disabled = false;
                        kurikulumData[selectedJenjang][selectedKelas][selectedMapel].forEach(bab => {
                            babEl.innerHTML += `<option value="${bab}">${bab}</option>`;
                        });
                    }
                });

                babEl.addEventListener('change', () => {
                    if(babEl.value){
                        topikEl.value = `${babEl.value} (${mapelEl.value} - ${kelasEl.value})`;
                    } else {
                        topikEl.value = '';
                    }
                });

                topikEl.addEventListener('input', () => {
                    if (jenjangEl.value !== "") {
                        jenjangEl.value = "";
                        jenjangEl.dispatchEvent(new Event('change'));
                    }
                });
            }

            function renderPremiumAIOutput(rawText, outputElement) {
                // Sanitize the raw text to prevent potential HTML injection issues if not intended
                // For this app, we trust the AI to produce safe HTML, so we directly use innerHTML.
                // In a production app with user input, consider using a sanitizer.
                outputElement.innerHTML = rawText;

                // Render LaTeX math expressions
                if (window.renderMathInElement) {
                    try {
                        renderMathInElement(outputElement, {
                            delimiters: [
                                {left: '$$', right: '$$', display: true},
                                {left: '$', right: '$', display: false}
                            ],
                            throwOnError: false
                        });
                    } catch (e) {
                        console.error("KaTeX rendering error:", e);
                    }
                }
            }

            async function callPremiumGeminiApi(promptParts, resultElId, loaderElId) {
                const resultEl = document.getElementById(resultElId);
                const loaderEl = document.getElementById(loaderElId);
                
                resultEl.innerHTML = '';
                resultEl.classList.add('hidden');
                loaderEl.classList.remove('hidden');

                const hasImage = promptParts.some(part => part.inlineData);
                const model = hasImage ? 'gemini-2.5-flash' : 'gemini-2.5-flash';
                const apiKey = getNextApiKey(); 

                if (!apiKey) {
                    resultEl.innerHTML = `<div class="error-state p-6 rounded-2xl border-2"><strong>Error:</strong> Tidak ada API Key yang tersedia.</div>`;
                    resultEl.classList.remove('hidden');
                    loaderEl.classList.add('hidden');
                    return;
                }

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
                const payload = { contents: [{ parts: promptParts }] };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error.message || `HTTP error! Status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    const textResult = result.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (textResult) {
                        renderPremiumAIOutput(textResult, resultEl);
                    } else {
                        throw new Error("Respons dari API tidak valid atau kosong.");
                    }
                } catch (error) {
                    console.error("Error calling Gemini API:", error);
                    resultEl.innerHTML = `<div class="error-state p-6 rounded-2xl border-2"><strong>Error:</strong> ${error.message}</div>`;
                } finally {
                    loaderEl.classList.add('hidden');
                    resultEl.classList.remove('hidden');
                    // Auto-scroll to the result
                    resultEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
             // NEW: API call function adapted for batch processing (returns text instead of rendering)
            async function callPremiumGeminiApiForBatch(promptParts) {
                const hasImage = promptParts.some(part => part.inlineData);
                const model = hasImage ? 'gemini-2.0-flash' : 'gemini-2.0-flash';
                const apiKey = getNextApiKey();

                if (!apiKey) {
                    return `<div class="error-state p-4 rounded-lg"><strong>Error:</strong> API Key tidak tersedia.</div>`;
                }

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
                const payload = { contents: [{ parts: promptParts }] };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error.message || `HTTP error! Status: ${response.status}`);
                    }

                    const result = await response.json();
                    const textResult = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (textResult) {
                        return textResult;
                    } else {
                        throw new Error("Respons dari API tidak valid atau kosong.");
                    }
                } catch (error) {
                    console.error("Error in batch API call:", error);
                    return `<div class="error-state p-4 rounded-lg"><strong>Error:</strong> ${error.message}</div>`;
                }
            }
            
            // --- Premium Event Listeners ---
            function attachPremiumEventListeners() {
                const latexInstruction = `\n\n**PERINTAH FORMAT PENTING**: Setiap kali Anda menulis rumus, persamaan, atau ekspresi matematika, WAJIB gunakan format LaTeX. Untuk matematika inline, bungkus dengan satu tanda dolar (contoh: $E=mc^2$). Untuk matematika dalam blok display terpisah, bungkus dengan dua tanda dolar (contoh: $$y = \\frac{a}{b+c}$$). Ini sangat penting untuk rendering yang benar.`;
                const listStyleInstruction = `\n**INSTRUKSI DAFTAR**: Untuk daftar bernomor, selalu gunakan <ol style="list-style-type: decimal; padding-left: 40px;">. Untuk daftar berpoin, gunakan <ul style="list-style-type: disc; padding-left: 40px;">.`;

                document.getElementById('btn-generate-materi')?.addEventListener('click', () => {
                    const topic = document.getElementById('materi-topik').value;
                    const isDifferentiated = document.getElementById('materi-diferensiasi').checked;
                    let prompt = `Anda adalah seorang ahli perancang kurikulum. **Seluruh output Anda HARUS berupa kode HTML yang valid dan siap render, tanpa teks pembuka atau penutup.** Buat materi ajar untuk topik: "${topic}".`;
                    
                    if (isDifferentiated) {
                        prompt += ` Struktur HTML HARUS menyajikan tiga bagian utama yang jelas: <h2>Materi Diferensiasi: ${topic}</h2><h3>1. Versi Disederhanakan</h3><p>Penjelasan untuk siswa dengan pemahaman dasar.</p><h3>2. Versi Standar</h3><p>Penjelasan sesuai standar kurikulum.</p><h3>3. Versi Pengayaan</h3><p>Penjelasan mendalam dengan konsep tambahan.</p> Setiap bagian harus terstruktur dengan baik.`;
                    } else {
                        prompt += ` Struktur HTML harus mencakup: <h2>${topic}</h2>, diikuti oleh beberapa bagian yang masing-masing memiliki <h3>Sub-Judul</h3> dan paragraf <p> yang menjelaskan konsep.`;
                    }
                    prompt += listStyleInstruction + latexInstruction;
                    callPremiumGeminiApi([{text: prompt}], 'materi-hasil', 'materi-loader');
                });

                document.getElementById('btn-generate-glosarium')?.addEventListener('click', () => {
                    const text = document.getElementById('glosarium-teks').value;
                    let prompt = `Anda adalah AI ahli linguistik. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.** Dari teks berikut, identifikasi 5-7 istilah paling penting. Untuk setiap istilah, gunakan format HTML berikut secara presisi: <h3>Istilah Kunci</h3><p>Definisi yang jelas.</p><h4>Contoh Penggunaan:</h4><ul style="list-style-type: disc; padding-left: 40px;"><li>Contoh kalimat 1</li></ul>. Teks untuk dianalisis: "${text}"`;
                    prompt += latexInstruction;
                    callPremiumGeminiApi([{text: prompt}], 'glosarium-hasil', 'glosarium-loader');
                });

                document.getElementById('btn-generate-konteks')?.addEventListener('click', async () => {
                    const imageFile = document.getElementById('konteks-gambar').files[0];
                    if (!imageFile) { 
                        alert("Silakan unggah sebuah gambar untuk dianalisis."); 
                        return; 
                    }
                    
                    let prompt = `Anda adalah sejarawan seni dan ahli pedagogi. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.** Berdasarkan gambar ini, buat analisis mendalam dengan struktur HTML berikut:\n<h2>Deskripsi Visual Detail</h2><p>[Deskripsi mendalam tentang gambar]</p>\n<h2>Poin Diskusi & Pertanyaan HOTS</h2><ol style="list-style-type: decimal; padding-left: 40px;"><li>Pertanyaan 1</li><li>Pertanyaan 2</li></ol>\n<h2>Fakta Menarik Terkait</h2><ul style="list-style-type: disc; padding-left: 40px;"><li>Fakta 1</li></ul>`;
                    prompt += latexInstruction;
                    
                    const { base64, mimeType } = await fileToBase64(imageFile);
                    const promptParts = [{ text: prompt }, { inlineData: { mimeType: mimeType, data: base64 } }];
                    callPremiumGeminiApi(promptParts, 'konteks-hasil', 'konteks-loader');
                });

                document.getElementById('btn-generate-soal')?.addEventListener('click', () => {
                    const topic = document.getElementById('soal-topik').value;
                    const type = document.getElementById('soal-tipe').value;
                    const count = document.getElementById('soal-jumlah').value;
                    const withExplanation = document.getElementById('soal-pembahasan').checked;
                    
                    let prompt = `Anda adalah AI spesialis evaluasi pendidikan. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.** Buatkan ${count} soal tipe "${type}" untuk topik "${topic}".`;

                    if (type === 'Pilihan Ganda') {
                        prompt += `\nSetiap soal HARUS berada dalam tag <li> di dalam sebuah <ol>. Pilihan jawaban (A, B, C, D, dst) HARUS berada di dalam daftar <ol type="A" style="list-style-type: upper-alpha; margin-left: 20px; padding-left: 20px;"> di dalam setiap <li> soal.`
                    }
                    
                    if (withExplanation) {
                        prompt += `\nStruktur HTML WAJIB:\n<h2>Latihan Soal: ${topic}</h2>\n<ol style="list-style-type: decimal; padding-left: 40px;">\n  <li>Isi soal 1...\n    <ol type="A" style="list-style-type: upper-alpha; margin-left: 20px; padding-left: 20px;">\n      <li>Pilihan A</li>\n      <li>Pilihan B</li>\n    </ol>\n  </li>\n</ol>\n<h2>Kunci Jawaban & Pembahasan</h2>\n<div>\n  <h3>Soal 1</h3>\n  <p><strong>Jawaban:</strong> [Kunci Jawaban, misal: A]</p>\n  <p><strong>Pembahasan:</strong> Penjelasan detail...</p>\n</div>`;
                    } else {
                        prompt += `\nStruktur HTML WAJIB:\n<h2>Latihan Soal: ${topic}</h2>\n<ol style="list-style-type: decimal; padding-left: 40px;">\n  <li>Isi soal 1...\n    <ol type="A" style="list-style-type: upper-alpha; margin-left: 20px; padding-left: 20px;">\n      <li>Pilihan A</li>\n      <li>Pilihan B</li>\n    </ol>\n  </li>\n</ol>\n<h3>Kunci Jawaban</h3>\n<ol style="list-style-type: decimal; padding-left: 40px;">\n  <li>Jawaban soal 1</li>\n</ol>`;
                    }
                    prompt += latexInstruction;
                    callPremiumGeminiApi([{text: prompt}], 'soal-hasil', 'soal-loader');
                });
                
                // MODIFIED: Event listener for batch "Penjawab Soal"
                document.getElementById('btn-generate-penjawab-soal')?.addEventListener('click', async () => {
                    const questionText = document.getElementById('penjawab-soal-teks').value;
                    const imageFiles = document.getElementById('penjawab-soal-gambar').files;

                    if (!questionText && (!imageFiles || imageFiles.length === 0)) {
                        alert("Silakan masukkan soal dalam bentuk teks atau unggah setidaknya satu gambar.");
                        return;
                    }

                    const resultEl = document.getElementById('penjawab-soal-hasil');
                    const loaderEl = document.getElementById('penjawab-soal-loader');
                    const loaderTextP = loaderEl.querySelector('p');
                    
                    resultEl.innerHTML = '';
                    resultEl.classList.add('hidden');
                    loaderEl.classList.remove('hidden');

                    // Handle image-based questions (batch or single)
                    if (questionText && imageFiles.length === 0) {
                        if (loaderTextP) loaderTextP.textContent = 'AI sedang mengerjakan soal teks...';
                        let prompt = `Anda adalah tutor AI jenius. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.** Berikan jawaban dan pembahasan langkah-demi-langkah untuk soal berikut: "${questionText}". Gunakan struktur HTML ini:\n<h2>Analisis Soal</h2><p>[Jelaskan apa yang ditanyakan soal]</p>\n<h2>pembahasan Pengerjaan</h2><ol style="list-style-type: decimal; padding-left: 40px;"><li>Langkah 1...</li><li>Langkah 2...</li></ol>\n<h2>Jawaban Akhir</h2><p><strong>[Jawaban akhir ditulis tebal]</strong></p>`;
                        prompt += latexInstruction;
                        await callPremiumGeminiApi([{ text: prompt }], 'penjawab-soal-hasil', 'penjawab-soal-loader');
                    } else { // Handle image-based questions (batch or single)
                        let accumulatedResultsHTML = '';
                        for (let i = 0; i < imageFiles.length; i++) {
                            const file = imageFiles[i];
                            if (loaderTextP) loaderTextP.textContent = `AI sedang mengerjakan soal dari gambar ${i + 1} dari ${imageFiles.length}...`;
                            
                            let prompt = `Anda adalah tutor AI jenius. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.** Berikan jawaban dan pembahasan langkah-demi-langkah untuk soal yang ada pada gambar. Gunakan struktur HTML ini:\n<h2>Analisis Soal</h2><p>[Jelaskan apa yang ditanyakan soal]</p>\n<h2>Langkah-langkah Pengerjaan</h2><ol style="list-style-type: decimal; padding-left: 40px;"><li>Langkah 1...</li><li>Langkah 2...</li></ol>\n<h2>Jawaban Akhir</h2><p><strong>[Jawaban akhir ditulis tebal]</strong></p>`;
                            prompt += latexInstruction;
                            
                            const promptParts = [{ text: prompt }];
                            if (questionText) { promptParts.push({ text: `\nKonteks/Pertanyaan Tambahan (teks): ${questionText}` }); }
                            
                            const { base64, mimeType, dataUrl } = await fileToBase64(file);
                            promptParts.push({ inlineData: { mimeType, data: base64 } });

                            const resultText = await callPremiumGeminiApiForBatch(promptParts);
                            
                            accumulatedResultsHTML += `
                                <div class="mb-8 p-4 border border-slate-200 rounded-2xl bg-white shadow-sm">
                                    <h3 class="text-xl font-bold mb-4 text-slate-700">Hasil untuk: ${file.name}</h3>
                                    <img src="${dataUrl}" class="max-h-48 rounded-lg border mb-4 shadow-sm" alt="Gambar soal ${i + 1}">
                                    <div>${resultText}</div>
                                </div>
                            `;
                        }
                        renderPremiumAIOutput(accumulatedResultsHTML, resultEl);
                        resultEl.classList.remove('hidden');
                        loaderEl.classList.add('hidden');
                        // Auto-scroll to results after batch processing
                        resultEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                    if (loaderTextP) loaderTextP.textContent = 'AI sedang bekerja untuk Anda...'; // Reset loader text
                });


                document.getElementById('btn-generate-proyek')?.addEventListener('click', () => {
                    const theme = document.getElementById('proyek-tema').value;
                    const duration = document.getElementById('proyek-durasi').value;
                    let prompt = `Anda adalah ahli pedagogi PBL. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.** Buatkan draf lengkap rencana proyek dengan detail:\n- Tema: "${theme}"\n- Durasi: "${duration}"\n\nStruktur output HTML WAJIB:\n<h2>Rancangan Proyek: ${theme}</h2>\n<h3>A. Pertanyaan Pemantik</h3>\n<h3>B. Aktivitas & Linimasa</h3>\n<h3>C. Produk Akhir & Kriteria Penilaian</h3>`;
                    prompt += listStyleInstruction + latexInstruction;
                    callPremiumGeminiApi([{text: prompt}], 'proyek-hasil', 'proyek-loader');
                });

                const activityCards = document.querySelectorAll('.activity-choice-card');
                activityCards.forEach(card => {
                    card.addEventListener('click', () => {
                        const activityType = card.dataset.activityType;
                        const activityTitle = card.dataset.activityTitle;
                        
                        const cardContainer = document.getElementById('aktivitas-card-container');
                        const formContainer = document.getElementById('aktivitas-form-container');

                        cardContainer.classList.add('hidden');

                        const formHTML = `
                            <button id="btn-back-aktivitas" class="mb-6 text-slate-600 hover:text-primary-600 font-semibold flex items-center">
                                <i class="fas fa-arrow-left mr-2"></i> Kembali Pilih Aktivitas
                            </button>
                            ${createPremiumTopicSelectorHTML('aktivitas', `Rancang Aktivitas: ${activityTitle}`, '', 'Rancang Aktivitas', 'fa-users')}
                        `;
                        
                        formContainer.innerHTML = formHTML;
                        formContainer.classList.remove('hidden');

                        initializePremiumTopicSelector('aktivitas');
                        
                        document.getElementById('btn-back-aktivitas').addEventListener('click', () => {
                            formContainer.classList.add('hidden');
                            cardContainer.classList.remove('hidden');
                            formContainer.innerHTML = '';
                        });
                        
                        const generateBtn = document.getElementById('btn-generate-aktivitas');
                        generateBtn.dataset.activityType = activityType;
                        
                        generateBtn.addEventListener('click', () => {
                            const topic = document.getElementById('aktivitas-topik').value;
                            const selectedActivity = generateBtn.dataset.activityType;
                            
                            let prompt = `Anda adalah fasilitator pembelajaran kreatif. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.** Rancang panduan lengkap untuk aktivitas kelas "${selectedActivity}" dengan topik "${topic}". Gunakan struktur HTML berikut:\n<h2>Panduan Aktivitas: ${selectedActivity}</h2>\n<h3>Tujuan Pembelajaran</h3>\n<h3>Alat & Bahan</h3>\n<h3>Langkah-langkah Pelaksanaan</h3><ol style="list-style-type: decimal; padding-left: 40px;"><li>Langkah 1...</li></ol>\n<h3>Materi Pendukung untuk Siswa</h3>`;
                            prompt += listStyleInstruction + latexInstruction;
                            callPremiumGeminiApi([{text: prompt}], 'aktivitas-hasil', 'aktivitas-loader');
                        });
                    });
                });

                document.getElementById('btn-generate-kuis')?.addEventListener('click', () => {
                    const topic = document.getElementById('kuis-topik').value;
                    let prompt = `Anda adalah AI pembuat kuis. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.** Buat kuis formatif tentang "${topic}" berisi 10 pertanyaan (5 PG, 3 Benar/Salah, 2 Isian Singkat). Gunakan struktur HTML berikut:\n<h2>Kuis: ${topic}</h2>\n<h3>Pilihan Ganda</h3><ol style="list-style-type: decimal; padding-left: 40px;"><li>...</li></ol>\n<h3>Benar/Salah</h3><ol start="6" style="list-style-type: decimal; padding-left: 40px;"><li>...</li></ol>\n<h3>Isian Singkat</h3><ol start="9" style="list-style-type: decimal; padding-left: 40px;"><li>...</li></ol><br><h3>Kunci Jawaban</h3><p>[Kunci jawaban untuk semua soal]</p>`;
                    prompt += latexInstruction;
                    callPremiumGeminiApi([{text: prompt}], 'kuis-hasil', 'kuis-loader');
                });

                document.getElementById('btn-generate-jawaban')?.addEventListener('click', () => {
                    const question = document.getElementById('pertanyaan-siswa').value;
                    let prompt = `Anda adalah "coach" guru. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.** Siswa bertanya: "${question}". Berikan strategi menjawab dengan struktur HTML berikut:\n<h2>Strategi Menjawab Pertanyaan Siswa</h2>\n<ol style="list-style-type: decimal; padding-left: 40px;">\n<li><h3>Jawaban Langsung & Sederhana</h3><p>[Penjelasan mudah]</p></li>\n<li><h3>Analogi atau Perumpamaan</h3><p>[Analogi untuk membantu pemahaman]</p></li>\n<li><h3>Ide Aktivitas Cepat</h3><p>[Aktivitas singkat untuk visualisasi]</p></li>\n</ol>`;
                    prompt += latexInstruction;
                    callPremiumGeminiApi([{text: prompt}], 'jawaban-hasil', 'jawaban-loader');
                });

                // MODIFIED: Event listener for batch "Penilaian Terpadu"
                document.getElementById('btn-generate-penilaian-terpadu')?.addEventListener('click', async () => {
                    const answerSheetImageFiles = document.getElementById('penilaian-terpadu-gambar').files;
                    const answerKeyText = document.getElementById('penilaian-terpadu-kunci-teks').value;
                    const answerKeyImageFile = document.getElementById('penilaian-terpadu-kunci-gambar').files[0];
                    const gradingScale = document.getElementById('penilaian-terpadu-skala').value;

                    if (!answerSheetImageFiles || answerSheetImageFiles.length === 0) {
                        alert("Mohon unggah setidaknya satu gambar lembar jawaban siswa.");
                        return;
                    }

                    const resultEl = document.getElementById('penilaian-terpadu-hasil');
                    const loaderEl = document.getElementById('penilaian-terpadu-loader');
                    const loaderTextP = loaderEl.querySelector('p');
                    
                    resultEl.innerHTML = '';
                    resultEl.classList.add('hidden');
                    loaderEl.classList.remove('hidden');

                    let accumulatedResultsHTML = '';

                    // Prepare answer key part once
                    const keyPromptParts = [];
                    if (answerKeyText) keyPromptParts.push({ text: `\nKunci Jawaban (teks): \n${answerKeyText}` });
                    if(answerKeyImageFile) {
                        const keyImg = await fileToBase64(answerKeyImageFile);
                        keyPromptParts.push({ text: "\nKunci Jawaban (gambar):" }, { inlineData: { mimeType: keyImg.mimeType, data: keyImg.base64 } });
                    }

                    for (let i = 0; i < answerSheetImageFiles.length; i++) {
                        const file = answerSheetImageFiles[i];
                        if (loaderTextP) loaderTextP.textContent = `AI sedang menilai lembar jawaban ${i + 1} dari ${answerSheetImageFiles.length}...`;
                        
                        let prompt = `Anda adalah AI penilai yang teliti. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.** Tugas: Periksa lembar jawaban siswa (gambar 1) dan bandingkan dengan kunci jawaban yang diberikan (teks atau gambar 2). Skala Penilaian: "${gradingScale}".\nInstruksi: Ekstrak nama/kelas, hitung skor, dan hasilkan laporan dengan format HTML WAJIB berikut:\n<h2>Laporan Hasil Penilaian</h2>\n<h4><strong>Nama:</strong> [Nama Siswa]</h4>\n<h4><strong>Kelas:</strong> [Kelas Siswa]</h4>\n<h3>Nilai Akhir: [Nilai]</h3>\n<h3>Analisis Jawaban:</h3>\n(Gunakan tabel HTML dengan kolom: Nomor, Jawaban Siswa, Kunci, Status)\n<h3>Umpan Balik:</h3>\n<p>Umpan balik konstruktif.</p>`;
                        
                        const { base64, mimeType, dataUrl } = await fileToBase64(file);
                        const promptParts = [{ text: prompt }, { inlineData: { mimeType, data: base64 } }];
                        promptParts.push(...keyPromptParts); // Add the prepared key
                        promptParts.push({text: listStyleInstruction + latexInstruction});
                        
                        const resultText = await callPremiumGeminiApiForBatch(promptParts);

                        accumulatedResultsHTML += `
                            <div class="mb-8 p-4 border border-slate-200 rounded-2xl bg-white shadow-sm">
                                <h3 class="text-xl font-bold mb-4 text-slate-700">Hasil untuk: ${file.name}</h3>
                                <img src="${dataUrl}" class="max-h-48 rounded-lg border mb-4 shadow-sm" alt="Lembar jawaban ${i + 1}">
                                <div>${resultText}</div>
                            </div>
                        `;
                    }

                    renderPremiumAIOutput(accumulatedResultsHTML, resultEl);
                    resultEl.classList.remove('hidden');
                    loaderEl.classList.add('hidden');
                    if (loaderTextP) loaderTextP.textContent = 'AI sedang menganalisis dan menilai...'; // Reset loader text
                     // Auto-scroll to results after batch processing
                    resultEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
                
                document.getElementById('btn-generate-penilaian-manual')?.addEventListener('click', async () => {
                    const studentName = document.getElementById('penilaian-manual-nama').value;
                    const studentClass = document.getElementById('penilaian-manual-kelas').value;
                    const answerText = document.getElementById('penilaian-manual-jawaban-teks').value;
                    const answerImageFile = document.getElementById('penilaian-manual-jawaban-gambar').files[0];
                    const answerKey = document.getElementById('penilaian-manual-kunci').value;
                    const gradingScale = document.getElementById('penilaian-manual-skala').value;

                    if (!answerText && !answerImageFile) {
                        alert("Mohon lengkapi Jawaban Siswa.");
                        return;
                    }

                    let prompt = `Anda AI asisten penilai. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.**\nTUGAS: Nilai esai siswa berdasarkan pedoman.\nDATA:\n- Nama: "${studentName}"\n- Kelas: "${studentClass}"\n- Pedoman: "${answerKey}"\n- Skala: "${gradingScale}"\nINSTRUKSI: Gunakan format HTML WAJIB:\n<h2>Hasil Penilaian Esai</h2>\n<h4><strong>Nama:</strong> ${studentName}</h4>\n<h3>Nilai: [Nilai]</h3>\n<h3>Umpan Balik Konstruktif:</h3>\n<p>[Analisis kekuatan dan area perbaikan]</p>`;
                    
                    const promptParts = [{ text: prompt }];
                    
                    if (answerText) promptParts.push({ text: `\nJawaban Siswa (teks): \n${answerText}` });
                    if (answerImageFile) {
                        const { base64, mimeType } = await fileToBase64(answerImageFile);
                        promptParts.push({ text: "\nJawaban Siswa (gambar):" }, { inlineData: { mimeType, data: base64 } });
                    }

                    promptParts.push({ text: listStyleInstruction + latexInstruction });
                    callPremiumGeminiApi(promptParts, 'penilaian-manual-hasil', 'penilaian-manual-loader');
                });

                document.getElementById('btn-generate-penilaian-esai-otomatis')?.addEventListener('click', async () => {
                    const questionText = document.getElementById('penilaian-esai-otomatis-soal').value;
                    const answerText = document.getElementById('penilaian-esai-otomatis-jawaban-teks').value;
                    const answerImageFile = document.getElementById('penilaian-esai-otomatis-jawaban-gambar').files[0];
                    const gradingScale = document.getElementById('penilaian-esai-otomatis-skala').value;

                    if (!questionText || (!answerText && !answerImageFile)) {
                        alert("Mohon lengkapi Soal Esai dan Jawaban Siswa.");
                        return;
                    }

                    const prompt = `Anda guru ahli penilai esai AI. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.**\nTUGAS: Nilai esai siswa secara otomatis.\nDATA:\n- Soal: "${questionText}"\n- Skala: "${gradingScale}"\nINSTRUKSI: Nilai berdasarkan akurasi, argumen, dan struktur. Gunakan format HTML WAJIB:\n<h2>Hasil Penilaian Esai Otomatis</h2>\n<h3>Nilai: [Nilai]</h3>\n<h3>Analisis & Umpan Balik:</h3>\n<ul style="list-style-type: disc; padding-left: 40px;"><li><strong>Akurasi Konten:</strong> [Komentar]</li><li><strong>Kejelasan Argumen:</strong> [Komentar]</li></ul>`;

                    const promptParts = [{ text: prompt }];

                    if (answerText) promptParts.push({ text: `\nJawaban Siswa (teks): \n${answerText}` });
                    if (answerImageFile) {
                        const { base64, mimeType } = await fileToBase64(answerImageFile);
                        promptParts.push({ text: "\nJawaban Siswa (gambar):" }, { inlineData: { mimeType, data: base64 } });
                    }

                    promptParts.push({ text: latexInstruction });
                    callPremiumGeminiApi(promptParts, 'penilaian-esai-otomatis-hasil', 'penilaian-esai-otomatis-loader');
                });
                
                document.getElementById('btn-generate-penilaian-otomatis')?.addEventListener('click', async () => {
                    const answerSheetImageFile = document.getElementById('penilaian-otomatis-gambar').files[0];
                    const answerKeyText = document.getElementById('penilaian-otomatis-kunci-teks').value;
                    const answerKeyImageFile = document.getElementById('penilaian-otomatis-kunci-gambar').files[0];
                    const gradingScale = document.getElementById('penilaian-otomatis-skala').value;

                    if (!answerSheetImageFile) {
                        alert("Mohon unggah gambar lembar jawaban siswa.");
                        return;
                    }
                    
                    const { base64, mimeType } = await fileToBase64(answerSheetImageFile);
                    let prompt;
                    const promptParts = [];

                    prompt = `Anda AI penilai. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.**\nTugas: Periksa lembar jawaban (gambar 1) dengan kunci (teks/gambar 2). Skala: "${gradingScale}".\nInstruksi: Deteksi nama/kelas. Hitung skor. Buat laporan HTML dengan format WAJIB:\n<h2>Hasil Penilaian</h2>\n<h4>Nama: [Nama]</h4><h3>Nilai Akhir: [Nilai]</h3><h3>Analisis Jawaban:</h3>(tabel HTML: No, Jawaban Siswa, Kunci, Status)\n<h3>Umpan Balik</h3>`;
                    promptParts.push({ text: prompt }, { inlineData: { mimeType, data: base64 } });
                    if (answerKeyText) promptParts.push({ text: `\nKunci Jawaban (teks): \n${answerKeyText}` });
                    if(answerKeyImageFile) {
                        const keyImg = await fileToBase64(answerKeyImageFile);
                        promptParts.push({ text: "\nKunci Jawaban (gambar):" }, { inlineData: { mimeType: keyImg.mimeType, data: keyImg.base64 } });
                    }
                    
                    promptParts.push({text: listStyleInstruction + latexInstruction});
                    callPremiumGeminiApi(promptParts, 'penilaian-otomatis-hasil', 'penilaian-otomatis-loader');
                });
                
                document.getElementById('btn-generate-komunikasi')?.addEventListener('click', () => {
                    const studentName = document.getElementById('komunikasi-nama').value;
                    const purpose = document.getElementById('komunikasi-tujuan').value;
                    const keyPoints = document.getElementById('komunikasi-poin').value;
                    const prompt = `Anda konselor sekolah ahli komunikasi. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.** Buatkan draf pesan profesional untuk orang tua siswa "${studentName}" dengan tujuan: "${purpose}" dan poin kunci: "${keyPoints}".\nStruktur HTML WAJIB:\n<p><strong>Yth. Bapak/Ibu Wali dari ${studentName},</strong></p>\n<p>[Isi pesan sopan dan kolaboratif]</p>\n<p>Salam hangat,</p><p>[Nama Guru]</p>`;
                    callPremiumGeminiApi([{text: prompt}], 'komunikasi-hasil', 'komunikasi-loader');
                });
                
                document.getElementById('btn-generate-rpp')?.addEventListener('click', () => {
                    const topic = document.getElementById('rpp-topik').value;
                    const duration = document.getElementById('rpp-durasi').value;
                    const objective = document.getElementById('rpp-tujuan').value;
                    let prompt = `Anda AI perancang pembelajaran. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.** Buatkan draf RPP untuk:\n- Topik: "${topic}"\n- Durasi: ${duration} menit\n- Tujuan: "${objective}"\nStruktur HTML WAJIB:\n<h2>RPP: ${topic}</h2>\n<h3>A. Tujuan Pembelajaran</h3>\n<h3>B. Kegiatan Pembelajaran</h3><ol style="list-style-type: decimal; padding-left: 40px;"><li><strong>Pendahuluan:</strong> ...</li><li><strong>Kegiatan Inti:</strong> ...</li><li><strong>Penutup:</strong> ...</li></ol>\n<h3>C. Asesmen/Penilaian</h3>`;
                    prompt += listStyleInstruction + latexInstruction;
                    callPremiumGeminiApi([{text: prompt}], 'rpp-hasil', 'rpp-loader');
                });

                document.getElementById('btn-generate-analisis-rpp')?.addEventListener('click', () => {
                    const rppText = document.getElementById('analisis-rpp-teks').value;
                    let prompt = `Anda "coach" pedagogis AI. **Seluruh output Anda HARUS berupa kode HTML yang valid, tanpa teks pembuka atau penutup.** Analisis RPP berikut dan berikan umpan balik konstruktif dengan format HTML WAJIB:\n<h2>Analisis RPP</h2>\n<h3>1. Kekuatan RPP</h3><p>[Aspek yang sudah baik]</p>\n<h3>2. Area untuk Peningkatan</h3><p>[Saran perbaikan]</p>\n<h3>3. Peluang Diferensiasi</h3><p>[Saran untuk mengakomodasi siswa]</p>\n\nRPP untuk dianalisis:\n"${rppText}"`;
                    prompt += listStyleInstruction + latexInstruction;
                    callPremiumGeminiApi([{ text: prompt }], 'analisis-rpp-hasil', 'analisis-rpp-loader');
                });
                
                // Tab system initialization
                function initializePremiumTabLogic(containerId) {
                    const container = document.getElementById(containerId);
                    if (!container) return;

                    const nav = container.querySelector('nav');
                    if (!nav) return;

                    nav.addEventListener('click', (event) => {
                        const button = event.target.closest('.premium-tab-button');
                        if (!button) return;

                        const targetId = button.dataset.target;
                        if (!targetId) return;

                        const isNested = container.id.includes('nested');
                        const contentSelector = isNested ? '.tab-content-nested' : '.tab-content';

                        nav.querySelectorAll('.premium-tab-button').forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');

                        const contentPanes = container.querySelectorAll(`:scope > ${contentSelector}, :scope > div > ${contentSelector}`);
                        contentPanes.forEach(pane => pane.classList.remove('active'));
                        
                        const targetContent = container.querySelector(`#${targetId}`);
                        if (targetContent) {
                            targetContent.classList.add('active');
                        }
                    });
                }
                
                initializePremiumTabLogic('perencana-rpp-tabs-container');
                initializePremiumTabLogic('penilaian-tabs-container');  
                initializePremiumTabLogic('penilaian-esai-nested-tabs-container');
                
                // Initialize all topic selectors
                ['materi', 'soal', 'kuis', 'rpp', 'aktivitas'].forEach(initializePremiumTopicSelector);
                
                // Initialize all SINGLE image uploaders  
                ['konteks', 'penilaian-terpadu-kunci', 'penilaian-otomatis', 'penilaian-otomatis-kunci', 'penilaian-esai-otomatis-jawaban', 'penilaian-manual-jawaban'].forEach(setupPremiumImageUploader);

                 // NEW: Initialize all BATCH image uploaders
                ['penjawab-soal', 'penilaian-terpadu'].forEach(setupPremiumBatchUploader);

            }
            
            function attachBackToHomeListener() {
                document.querySelector('main').addEventListener('click', function(e) {
                    if (e.target.closest('.back-to-home-btn')) {
                        e.preventDefault();
                        switchTab('home');
                    }
                });
            }

            // --- INITIALIZE PREMIUM APP ---
            buildPremiumUI();
            attachPremiumEventListeners(); // This will attach all event listeners for the premium UI
            attachBackToHomeListener();
            
            // --- NEW: History Management for Mobile Back Button ---
            // Set the initial state to 'home' when the page loads
            history.replaceState({ page: 'home' }, 'Home', '#home');

            window.addEventListener('popstate', (event) => {
                // --- Sidebar back button logic ---
                const sidebarIsOpen = !sidebar.classList.contains('-translate-x-full');
                if (sidebarIsOpen && (!event.state || !event.state.sidebarOpen)) {
                    closeSidebar();
                }

                // --- Page navigation logic ---
                const state = event.state;
                const targetId = state ? state.page : (location.hash.substring(1) || 'home');
                
                const validSection = document.getElementById(targetId);
                
                if (validSection && validSection.classList.contains('content-section')) {
                     // The 'true' flag tells switchTab this is from a popstate, so it doesn't push a new history state.
                    switchTab(targetId, true);
                } else {
                    // Fallback to home if the hash points to a non-existent section
                    switchTab('home', true);
                }
            });

        });
    </script>
</body>
</html>



